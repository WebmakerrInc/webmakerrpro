import{j as e,b as c}from"./BlockEditorTranslator-Do4trUgb.js";import{I as w,P as I,E as O}from"./ProductListItem-D_5QaYKg.js";import{f as A}from"./Icons-B2jBVdSk.js";import"./index-CGoo2crO.js";import{a as L}from"./index-BYEX9EM_.js";import{a as M}from"./add-query-args-COp5A_Oq.js";const{useEffect:k,useState:x}=wp.element,v=window.fluentCartRestVars.rest,D=g=>{const{preSelectedVariations:o,onVariationSelectionUpdated:p,isMultiple:l=!0,translationKey:d="fluent_cart_pricing_table_block_editor_data",allow_subscription:u=!0}=g,y=v.url+"/products",[f,m]=x(!1),[h,b]=x({per_page:10,current_page:1,total:0,last_page:1}),[r,i]=x({}),[n,j]=x(o||{}),_=(t,a)=>{let s={...n};a?(l||(s={}),s[t.id]={...t}):s.hasOwnProperty(t.id)&&delete s[t.id],j(s),typeof p=="function"&&p(s)},S=(t=null)=>{m(!0),i({});let a={admin_filters:{},with:["detail","variants"],active_view:"publish",per_page:10,page:1,order_by:"ID",order_type:"DESC",search:t};u||(a.scopes=["cartable"]),L({path:M(y,{...a}),headers:{"X-WP-Nonce":v.nonce}}).then(s=>{let E={...h,per_page:s.products.per_page,current_page:s.products.current_page,total:s.products.total,last_page:s.products.last_page},P=s.products.data;console.log(P,"products"),b(N=>({...N,...E})),i(N=>({...N,...P}))}).finally(()=>{m(!1)})};k(()=>{S()},[]),k(()=>{j(o||{})},[o]);const C=t=>{S(t)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fc-popup-search-wrap",children:e.jsx(w,{icon:!0,name:"search",placeholder:c("Type to search for products, then hit Enter"),onKeyDown:t=>{const a=t.target.value;t.key==="Enter"&&C(a)}})}),e.jsx("div",{className:"fc-popup-body-inner",children:f?e.jsx("div",{className:"fc-skeleton-container",children:[...Array(9)].map((t,a)=>e.jsx("div",{className:"skeleton skeleton-item"},a))}):Object.keys(r).length>0?e.jsx("div",{className:"fc-popup-product-list-container",children:e.jsx("ul",{className:"fc-collapsible-list",children:Object.entries(r).map((t,a)=>e.jsx("li",{className:"fc-collapsible-list-item",children:e.jsx(I,{allow_subscription:u,isMultiple:l,products:r,index:a,selectedVariations:{...n},updateSelectedVariations:_})},a))})}):e.jsx(O,{text:c("We couldn't find any products matching your search")})})]})},{useEffect:F,useState:V}=wp.element,q=g=>{const{preSelectedVariations:o,setAttributes:p,onModalClosed:l,isMultiple:d=!0,buttonLabel:u,allow_subscription:y=!0,button:f=!1}=g,[m,h]=V(!1),[b,r]=V(o||{}),i=()=>{h(!0)},n=()=>{h(!1),typeof l=="function"&&l(b)},j=u||(d?c("Add Items"):c("Add Item"));return F(()=>{r(o||{})},[o]),e.jsxs(e.Fragment,{children:[f&&e.jsx("button",{className:"fc-button fc-button-secondary",onClick:i,children:c("Select Product")}),!f&&e.jsx(w,{icon:!0,placeholder:c("Search Products"),onClick:i}),m&&e.jsxs("div",{className:"fc-popup-container",children:[e.jsx("div",{className:"fc-popup-overlay",onClick:n}),e.jsxs("div",{className:"fc-popup-inner-container",children:[e.jsxs("div",{className:"fc-popup-head",children:[e.jsx("h4",{className:"fc-popup-head-title",children:d?c("Select Products"):c("Select Product")}),e.jsx("button",{type:"button",className:"fc-popup-close",onClick:n,children:e.jsx(A,{})})]}),e.jsx("div",{className:"fc-popup-body",children:e.jsx(D,{allow_subscription:y,preSelectedVariations:o,setAttributes:p,onVariationSelectionUpdated:_=>{r(_)},isMultiple:d})}),e.jsxs("div",{className:"fc-popup-footer",children:[e.jsx("button",{className:"fc-button fc-button-info-soft",onClick:n,children:c("Cancel")}),e.jsx("button",{className:"fc-button fc-button-primary",onClick:()=>{n()},disabled:Object.keys(b).length===0,children:j})]})]})]})]})};export{q as S};
