var $e=Object.defineProperty;var Ve=(a,t,s)=>t in a?$e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var ke=(a,t,s)=>Ve(a,typeof t!="symbol"?t+"":t,s);import{a as u,c as h,o,d as e,e as L,w as n,u as m,b as $,f as l,t as c,F as T,h as H,A as oe,g as x,i as O,z as ee,m as re,k as _e,j as ce,p as X,I as Le,x as Ee,O as j,y as Ae,r as Pe}from"./vue.esm-bundler-VLZRLwDo.js";import{C as R,c as B,d as F,T as Te,_ as Ue,P as Me,a as Ie}from"./RouteCell-BYUiwRDq.js";import{L as ne,_ as Oe}from"./NotFound-C0jL-sdJ.js";import{_ as Be,m as Ce,a as Fe,d as Ne,T as q,i as De}from"./dateShortCuts-DwuQmdrx.js";import{_ as me}from"./Empty-BDIgPk4r.js";import{t as p}from"./Translator-B6cROAk_.js";import{A as ae}from"./Arr-MwYQQ3qa.js";import{I as de,B as W,S as Se,P as Re}from"./Badge-DsywDH_m.js";import{a as He,bT as ze,b as je}from"./index-BSdFqZUc.js";import{_ as se,P as qe,L as Ye,O as ie,e as Ke,d as We}from"./OrderCustomerInformation-BSviIcPQ.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Y}from"./DynamicIcon-B1vpMEi_.js";import{d as Z}from"./dayjs.min-2rai63wT.js";import{M as Ge}from"./Model-D7MrDQPf.js";import{R as xe}from"./Rest-U7WPPDzn.js";import{f as Q,i as Xe}from"./common-BPfjXdxy.js";import{a as ue,C as Ze}from"./CopyToClipboard-O88DxGEb.js";import{S as Je}from"./Str-DQr93RbR.js";import"./SaveBar-DtOVjYBj.js";import"./Url-DcFY6RBb.js";import"./timezone-C2U15obx.js";import"./Notify-DKZN7muO.js";import"./Utils-rKpXNRVE.js";import"./Asset-CBhXzPc7.js";import"./index-CA48fF9Y.js";import"./productService-CeLFdK8B.js";const Qe={class:"fc-license-settings fc-layout-width"},et={key:1,class:"fc-license-settings-body"},tt={class:"fc-licensed-product-table hide-on-mobile"},nt={class:"fc-media-with-content"},at={class:"media"},lt=["src","alt"],st={class:"title"},it=["innerHTML"],ot=["innerHTML"],rt={class:"fct-product-pricing-table-item"},ct={class:"fc-licensed-product-table-mobile"},dt={class:"fc-licensed-product-table-mobile-col"},ut={class:"root-title"},_t={class:"fc-media-with-content"},mt={class:"media"},pt=["src","alt"],ht={class:"title"},ft=["innerHTML"],gt=["innerHTML"],vt={class:"fc-licensed-product-table-mobile-col"},bt={class:"root-title"},yt={class:"fct-product-pricing-table-item"},wt={key:0},kt={class:"custom-wp-editor-wrapper relative"},Lt={class:"absolute mb-0 font-bold"},Ct={key:0,class:"setting-save-action"},St={name:"LicenseSettings",props:["product_id"],data(){return{settings:null,saving:!1,loading:!1,product:{},globalUpdateFile:{},selectedFile:null,fetchSettings:!1}},methods:{fetchProduct(){this.loading=!0,this.$get("products/"+this.product_id+"/pricing",{}).then(a=>{this.product=a.product}).catch(a=>{this.handleError(a)}).finally(()=>{this.loading=!1})},getSettings(){this.fetchSettings=!0,this.$get(`licensing/products/${this.product_id}/settings`).then(a=>{var t,s;this.settings=a.settings,this.selectedFile=(t=a.settings.global_update_file)!=null&&t.id?parseInt((s=a.settings.global_update_file)==null?void 0:s.id):""}).catch(a=>{this.handleError(a)}).finally(()=>{this.fetchSettings=!1})},updateSettings(){this.saving=!0,this.$post(`licensing/products/${this.product_id}/settings`,{settings:this.settings}).then(a=>{this.handleSuccess(a.message)}).catch(a=>{this.handleError(a)}).finally(()=>{this.saving=!1})},imageUrl(a){var t;return a&&((t=a.meta_value)==null?void 0:t.length)>0?a.meta_value[0].url:this.appVars.asset_url+"images/empty-image.svg"},imageAlt(a){var t;return a&&((t=a.meta_value)==null?void 0:t.length)>0?a.meta_value[0].title:"No Image"}},mounted(){this.getSettings(),this.fetchProduct();const a=document.querySelector("#fca_admin_menu_holder .fc-admin-product-header");a&&document.querySelector("#fluent_cart_plugin_app").prepend(a)}},Dt=Object.assign(St,{setup(a){return(t,s)=>{const k=u("el-switch"),r=u("el-skeleton"),i=u("el-table-column"),S=u("el-input"),C=u("el-table"),b=u("el-form-item"),D=u("el-col"),V=u("el-option"),y=u("el-select"),P=u("el-row"),v=u("el-form"),I=u("el-button");return o(),h("div",Qe,[e(F,null,{default:n(()=>[e(R,{border_bottom:"",title:m(p)("License Settings")},{action:n(()=>[t.settings?(o(),$(k,{key:0,modelValue:t.settings.enabled,"onUpdate:modelValue":s[0]||(s[0]=f=>t.settings.enabled=f),"active-value":"yes","inactive-value":"no","active-text":m(p)("Enable Licensing for this product")},null,8,["modelValue","active-text"])):L("",!0)]),_:1},8,["title"]),e(B,null,{default:n(()=>[t.fetchSettings?(o(),$(r,{key:0,rows:6,animated:!0})):L("",!0),t.settings&&!t.fetchSettings?(o(),h("div",et,[t.settings.enabled==="yes"?(o(),$(v,{key:0,"label-position":"top",modelValue:t.settings,"onUpdate:modelValue":s[11]||(s[11]=f=>t.settings=f)},{default:n(()=>[e(b,null,{default:n(()=>[l("div",tt,[e(C,{ref:"elTable","row-key":f=>f.rowId,data:t.settings.variations},{default:n(()=>[e(i,{label:m(p)("Variant"),width:300},{default:n(f=>[l("div",nt,[l("div",at,[l("img",{src:t.imageUrl(f.row.media),alt:t.imageAlt(f.row.media)},null,8,lt)]),l("div",null,[l("div",st,c(f.row.title),1),f.row.subscription_info?(o(),h("div",{key:0,class:"text",innerHTML:f.row.subscription_info},null,8,it)):L("",!0),f.row.setup_fee_info?(o(),h("div",{key:1,class:"text",innerHTML:f.row.setup_fee_info},null,8,ot)):L("",!0)])])]),_:1},8,["label"]),e(i,{width:140},{header:n(()=>[e(ne,{title:m(p)("Activation Limit"),content:m(p)("Activation limit controls how many sites/devices can use this license. License validity matches your subscription interval. For example, an annual subscription will generate a license valid for one year.")},null,8,["title","content"])]),default:n(f=>[l("div",rt,[e(S,{type:"number",min:1,placeholder:m(p)("Use 0 or empty for no limit"),modelValue:f.row.activation_limit,"onUpdate:modelValue":U=>f.row.activation_limit=U},null,8,["placeholder","modelValue","onUpdate:modelValue"])])]),_:1})]),_:1},8,["row-key","data"])]),l("div",ct,[(o(!0),h(T,null,H(t.settings.variations,f=>(o(),h("div",{class:"fc-licensed-product-table-mobile-row",key:f.rowId},[l("div",dt,[l("div",ut,c(m(p)("Variant")),1),l("div",_t,[l("div",mt,[l("img",{src:t.imageUrl(f.media),alt:t.imageAlt(f.media)},null,8,pt)]),l("div",null,[l("div",ht,c(f.title),1),f.subscription_info?(o(),h("div",{key:0,class:"text",innerHTML:f.subscription_info},null,8,ft)):L("",!0),f.setup_fee_info?(o(),h("div",{key:1,class:"text",innerHTML:f.setup_fee_info},null,8,gt)):L("",!0)])])]),l("div",vt,[l("div",bt,[e(ne,{title:m(p)("Activation Limit"),content:m(p)("Activation limit controls how many sites/devices can use this license. License validity matches your subscription interval. For example, an annual subscription will generate a license valid for one year.")},null,8,["title","content"])]),l("div",yt,[e(S,{type:"number",min:1,placeholder:m(p)("Use 0 or empty for no limit"),modelValue:f.activation_limit,"onUpdate:modelValue":U=>f.activation_limit=U},null,8,["placeholder","modelValue","onUpdate:modelValue"])])])]))),128))])]),_:1}),e(P,{gutter:20},{default:n(()=>[e(D,{lg:8},{default:n(()=>[e(b,null,{label:n(()=>[e(ne,{title:m(p)("Version Number"),content:m(p)("Enter the current version number of your product.")},null,8,["title","content"])]),default:n(()=>[e(S,{placeholder:m(p)("Your Product Version"),modelValue:t.settings.version,"onUpdate:modelValue":s[1]||(s[1]=f=>t.settings.version=f)},null,8,["placeholder","modelValue"])]),_:1})]),_:1}),e(D,{lg:8},{default:n(()=>[e(b,null,{label:n(()=>[e(ne,{title:m(p)("License Key Prefix (Optional)"),content:m(p)("If you add any prefix here then it will will be used as the prefix of the generated license key")},null,8,["title","content"])]),default:n(()=>[e(S,{placeholder:m(p)("Your License Key Prefix"),modelValue:t.settings.prefix,"onUpdate:modelValue":s[2]||(s[2]=f=>t.settings.prefix=f)},null,8,["placeholder","modelValue"])]),_:1})]),_:1}),t.fetchSettings?L("",!0):(o(),$(D,{key:0,lg:8},{default:n(()=>[e(b,null,{label:n(()=>[e(ne,{title:m(p)("Update File"),content:m(p)("Update File (Choose the source file to get automatic updates)")},null,8,["title","content"])]),default:n(()=>{var f,U;return[((U=(f=t.product)==null?void 0:f.downloadable_files)==null?void 0:U.length)===0?(o(),h("span",wt,c(m(p)("No downloadable files found")),1)):(o(),$(y,{key:1,modelValue:t.settings.global_update_file,"onUpdate:modelValue":s[3]||(s[3]=_=>t.settings.global_update_file=_),placeholder:m(p)("Update File")},{default:n(()=>[(o(!0),h(T,null,H(t.product.downloadable_files,_=>(o(),$(V,{key:_.id,label:_.title,value:_.id.toString()},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]))]}),_:1})]),_:1}))]),_:1}),e(b,null,{default:n(()=>[l("div",kt,[l("label",Lt,c(m(p)("Changelog Description")),1),e(Be,{modelValue:t.settings.changelog,onUpdate:s[4]||(s[4]=f=>{t.settings.changelog=f})},null,8,["modelValue"])])]),_:1}),l("div",{class:oe("is-wp-product-wrap "+(t.settings.wp.is_wp==="yes"?"pb-0":""))},[l("div",{class:oe(t.settings.wp.is_wp==="yes"?"pb-4":"")},[e(k,{modelValue:t.settings.wp.is_wp,"onUpdate:modelValue":s[5]||(s[5]=f=>t.settings.wp.is_wp=f),"active-value":"yes","inactive-value":"no","active-text":m(p)("Is WP Plugin?")},null,8,["modelValue","active-text"])],2),t.settings.wp.is_wp==="yes"?(o(),h(T,{key:0},[e(b,{label:m(p)("Changelog Page URL")},{default:n(()=>[e(S,{placeholder:m(p)("Your Product Changelog Page URL"),modelValue:t.settings.wp.readme_url,"onUpdate:modelValue":s[6]||(s[6]=f=>t.settings.wp.readme_url=f)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),e(P,{gutter:20},{default:n(()=>[e(D,{md:12},{default:n(()=>[e(b,{label:m(p)("Banner URL")},{default:n(()=>[e(S,{placeholder:m(p)("Plugin Banner URL"),modelValue:t.settings.wp.banner_url,"onUpdate:modelValue":s[7]||(s[7]=f=>t.settings.wp.banner_url=f)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1}),e(D,{md:12},{default:n(()=>[e(b,{label:m(p)("Icon URL")},{default:n(()=>[e(S,{placeholder:m(p)("Plugin Icon URL"),modelValue:t.settings.wp.icon_url,"onUpdate:modelValue":s[8]||(s[8]=f=>t.settings.wp.icon_url=f)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1}),e(D,{md:12,xs:24},{default:n(()=>[e(b,{label:m(p)("Required PHP Version (optional)")},{default:n(()=>[e(S,{placeholder:m(p)("Required PHP Version"),modelValue:t.settings.wp.required_php,"onUpdate:modelValue":s[9]||(s[9]=f=>t.settings.wp.required_php=f)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1}),e(D,{md:12,xs:24},{default:n(()=>[e(b,{label:m(p)("Required WP Version (optional)")},{default:n(()=>[e(S,{placeholder:m(p)("Required WP Version"),modelValue:t.settings.wp.required_wp,"onUpdate:modelValue":s[10]||(s[10]=f=>t.settings.wp.required_wp=f)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})],64)):L("",!0)],2)]),_:1},8,["modelValue"])):L("",!0),t.settings.enabled!=="yes"?(o(),$(me,{key:1,icon:"Empty/WebPage",text:m(p)("License for this product has not been enabled")},null,8,["text"])):L("",!0)])):L("",!0)]),_:1})]),_:1}),t.settings?(o(),h("div",Ct,[e(I,{onClick:s[12]||(s[12]=f=>t.updateSettings()),loading:t.saving,disabled:t.saving,type:"primary"},{default:n(()=>[x(c(m(p)(" Update Settings")),1)]),_:1},8,["loading","disabled"])])):L("",!0)])}}});class xt extends Te{setupInitialData(){super.setupInitialData(),this.data.sorting.sortBy="order_id"}getTabs(){return{all:p("All"),active:p("Active"),inactive:p("Inactive"),expired:p("Expired"),disabled:p("Disabled")}}getToggleableColumns(){return[{label:p("Order ID"),value:"order_id"},{label:p("Product"),value:"product"},{label:p("Customer"),value:"customer"},{label:p("Date"),value:"date"}]}getSortableColumns(){return[{label:"Order ID",value:"order_id"},{label:"Activation Count",value:"activation_count"},{label:"Expiration Date",value:"expiration_date"},{label:"Date",value:"created_at"},{label:"Status",value:"status"}]}getSearchHint(){return p("by license key, order id, customer name/email or connected sites.")}getFetchUrl(){return"licensing/licenses"}parseResponse(t){return t.licenses}getTableName(){return"licenses"}getAdvanceFilterOptions(){return ae.get(window,"fluentCartAdminApp.filter_options.license_filter_options.advance")}getSearchGuideOptions(){return ae.get(window,"fluentCartAdminApp.filter_options.license_filter_options.guide")}with(){return["customer","product:ID,post_title","productVariant:id,variation_title"]}}function $t(a){return xt.init(a)}class Vt extends Ge{constructor(){super(...arguments);ke(this,"data",{summaryData:[],lineChartData:[],pieChartData:[],isBusy:!1})}get controllerKey(){return"LicenseReportController"}beforeInit(){}makeRequest(s,k,r,i){this.data.isBusy=!0,typeof k!="object"&&(k={});const S=xe.get(`reports/${s}`,k);return this.resolvePromiseResponse(S,r,i),S}resolvePromiseResponse(s,k=null,r=null){s.then(i=>{r==null||k==null||(this.data[r]=i[k])}).catch(i=>{console.log(i,"error")}).finally(()=>{this.data.isBusy=!1})}getLicenseLineChart(s={}){return this.makeRequest("license-chart",s,"lineChartData","lineChartData")}getLicensePieChart(s={}){return this.makeRequest("license-pie-chart",s,"pieChartData","pieChartData")}getSummary(s={}){return this.makeRequest("license-summary",s,"summaryData","summaryData")}}const N=Vt.init(),Et={class:"fc-license-statistics-wrap"},At={class:"fc-btn-group sm"},Pt={class:"chart-action-wrap"},Tt={class:"chart-change-wrap"},Ut={class:"chart-change"},Mt={class:"text"},It={class:"chart-change"},Ot={class:"text"},Bt={__name:"LicenseStatistics",props:{reportFilter:{type:Object}},setup(a){const t=a,s=O(null),k=O("daily"),r=O("line"),i=O([Z().startOf("month"),Z()]),S=[{value:"daily",label:"Daily"},{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly"}],C=ee(()=>[{title:"Total License",key:"total_license",color:"#2ecc71"}].map(({title:_,key:d,color:w},g)=>v(_,r.value,g%2,N.data.lineChartData.map(M=>M.license_count),w))),b=ee(()=>N.data.lineChartData.map(_=>{if(k.value==="daily"){const[d,w,g]=_.date.split("-");return`${Ce[parseInt(w)-1]} ${g}, ${d}`}else{if(k.value==="monthly")return`${Ce[parseInt(_.month)-1]} ${_.year}`;if(k.value==="yearly")return`${_.year}`}}));let D=null;const V=()=>{s.value&&D===null&&(D=De(s.value),y())},y=()=>{const _={title:{text:t.chartTitle??"",left:"center"},legend:{show:!1},tooltip:{trigger:"axis",backgroundColor:q.isDark()?"#38485a":"#ffffff",borderColor:q.isDark()?"#4a5a6b":"#c0c4ca",borderWidth:1,textStyle:{color:q.isDark()?"#ffffff":"#565865"}},xAxis:{type:"category",data:b.value,axisLabel:{color:q.isDark()?"#ffffff":"#565865",fontSize:12}},yAxis:[{type:"value",axisLabel:{color:q.isDark()?"#ffffff":"#565865",fontSize:12},splitLine:{show:!0,lineStyle:{color:q.isDark()?"#38485a":"#D6DAE1"}}},{type:"value",position:"right",axisLabel:{color:q.isDark()?"#ffffff":"#565865",fontSize:12},splitLine:{show:!1}}],dataZoom:[],series:C.value};D.setOption(_,{notMerge:!0,replaceMerge:["series"]})},P=()=>{const _={startDate:i.value[0].toISOString(),endDate:i.value[1].toISOString()};N.getLicenseLineChart({params:{..._,groupKey:k.value}})},v=(_,d,w,g,M)=>({name:_,type:d,yAxisIndex:w,data:g,smooth:!0,color:M,lineStyle:{width:3}}),I=()=>{P()},f=()=>{P()},U=_=>{r.value!==_&&(r.value=_,y())};return re([()=>N.chartData,r],()=>{X(y)},{deep:!0}),re(()=>N.data.lineChartData,()=>{X(()=>{y()})},{deep:!0}),_e(()=>{window.removeEventListener("onFluentCartThemeChange",y,!1)}),ce(()=>{window.addEventListener("onFluentCartThemeChange",y),P(),X(V)}),(_,d)=>{const w=u("el-option"),g=u("el-select"),M=u("el-date-picker");return o(),h("div",Et,[e(F,{id:"chartContainer"},{default:n(()=>[e(R,{title:_.$t("License Chart"),title_size:"small",border_bottom:""},{action:n(()=>[l("div",At,[e(Fe,{activeType:r.value,types:{line:"LineChart",bar:"BarChart"},onChange:U},null,8,["activeType"]),e(g,{class:"w-[100px] el-select--x-small",modelValue:k.value,"onUpdate:modelValue":d[0]||(d[0]=E=>k.value=E),onChange:f},{default:n(()=>[(o(),h(T,null,H(S,E=>e(w,{key:E.value,label:_.$t(E.label),value:E.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),e(M,{class:"w-[220px] el-range-editor--x-small hide-close-icon",modelValue:i.value,"onUpdate:modelValue":d[1]||(d[1]=E=>i.value=E),type:"daterange","range-separator":"-","start-placeholder":_.$t("Start date"),"end-placeholder":_.$t("End date"),"unlink-panels":"",clearable:!1,shortcuts:m(Ne),onChange:I},null,8,["modelValue","start-placeholder","end-placeholder","shortcuts"])])]),_:1},8,["title"]),e(B,null,{default:n(()=>[l("div",{class:"fc-license-statistics-chart",ref_key:"chartRef",ref:s},null,512),l("div",Pt,[l("div",Tt,[l("div",Ut,[d[2]||(d[2]=l("svg",{width:"9",height:"11",viewBox:"0 0 9 11",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[l("path",{d:"M4.6087 10.5L4.6087 1.46395",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"}),l("path",{d:"M1.00004 4.05762L4.55764 0.500019L8.11523 4.05762",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),l("span",Mt,c(_.$t("Data")),1)]),l("div",It,[l("span",Ot,c(_.$t("Timeline")),1),d[3]||(d[3]=l("svg",{class:"rotate-90",width:"9",height:"11",viewBox:"0 0 9 11",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[l("path",{d:"M4.6087 10.5L4.6087 1.46395",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"}),l("path",{d:"M1.00004 4.05762L4.55764 0.500019L8.11523 4.05762",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"})],-1))])])])]),_:1})]),_:1})])}}},Ft={class:"fc-usage-statistics-chart-wrap"},Nt={class:"fc-usage-statistics-info flex items-center justify-between"},Rt={class:"text-lg font-semibold text-system-dark dark:text-gray-50"},Ht={class:"text-xs font-medium text-system-mid dark:text-gray-300"},zt={class:"fc-custom-legend",style:{width:"100%"}},jt={style:{margin:"0 0 15px 0","font-size":"14px","font-weight":"600"}},qt={class:"legend-items"},Yt=["onClick","onMouseenter","onMouseleave"],Kt={style:{flex:"1","min-width":"0"}},Wt={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Gt=["title"],Xt={class:"legend-item-percentage"},Zt={class:"legend-item-count"},Jt={class:"fc-custom-legend-controls"},Qt={class:"fc-action-link-btn"},en={class:"fc-chart-container",style:{display:"flex","align-items":"flex-start"}},tn={__name:"UsageStatistics",props:{reportFilter:{type:Object},activatedSites:String|Number},setup(a){const t=a,s=q.colors;s.blue;const k=O(null),r=O("daily"),i=O("pie"),S=O([Z().startOf("month"),Z()]),C=O({}),b=ee(()=>N.data.pieChartData?N.data.pieChartData.map((w,g)=>({name:w.post_title,value:w.activation_count,percentage:w.percentage,color:D(g),visible:C.value[w.post_title]!==!1})):[]),D=w=>{const g=["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc","#ffb347"];return g[w%g.length]},V=ee(()=>N.data.pieChartData.filter(w=>C.value[w.post_title]!==!1).map((w,g)=>({value:w.activation_count,name:w.post_title,itemStyle:{color:D(N.data.pieChartData.findIndex(M=>M.post_title===w.post_title))}})));let y=null;const P=()=>{k.value&&y===null&&(y=De(k.value),v())},v=()=>{if(!y)return;const w={title:{text:t.chartTitle??"",left:"center"},legend:{show:!1},tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)",borderRadius:8,backgroundColor:q.isDark()?"#38485a":"#ffffff",textStyle:{color:q.isDark()?s.gray[25]:s.system.mid},borderColor:q.isDark()?"#4a5a6b":"#c0c4ca",borderWidth:1},series:[{type:"pie",radius:"55%",center:["50%","50%"],data:V.value,label:{show:!0,color:q.isDark()?s.gray[25]:s.system.dark},emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};y.setOption(w,{notMerge:!0,replaceMerge:["series"]})},I=w=>{C.value[w.name]=!w.visible,X(()=>{v()})},f=(w,g)=>{y&&(g?y.dispatchAction({type:"highlight",name:w.name}):y.dispatchAction({type:"downplay",name:w.name}))},U=()=>{const w={startDate:S.value[0].toISOString(),endDate:S.value[1].toISOString()};N.getLicensePieChart({params:{...w,groupKey:r.value}})},_=()=>{N.data.pieChartData&&N.data.pieChartData.forEach(w=>{w.post_title in C.value||(C.value[w.post_title]=!0)})};re([()=>N.chartData,i],()=>{X(v)},{deep:!0}),re(()=>N.data.pieChartData,()=>{_(),X(()=>{v()})},{deep:!0});const d=w=>{v()};return ce(()=>{window.addEventListener("onFluentCartThemeChange",d),U(),X(P)}),_e(()=>{window.removeEventListener("onFluentCartThemeChange",d)}),(w,g)=>{const M=u("el-popover");return o(),h("div",Ft,[l("div",Nt,[l("div",Rt,[x(c(a.activatedSites)+" ",1),l("div",Ht,c(w.$t("Total Activated Sites")),1)]),e(M,{placement:"bottom-start",width:226,trigger:"click","popper-class":"fc-license-statistics-popover"},{reference:n(()=>[l("div",Qt,[e(de,null,{default:n(()=>[e(Y,{name:"More"})]),_:1})])]),default:n(()=>[l("div",zt,[l("h4",jt,c(w.$t("License Distribution")),1),l("div",qt,[(o(!0),h(T,null,H(b.value,E=>(o(),h("div",{key:E.name,class:oe(["legend-item",{"legend-item-hidden":!E.visible}]),onClick:J=>I(E),onMouseenter:J=>f(E,!0),onMouseleave:J=>f(E,!1),style:Le({opacity:E.visible?1:.5})},[l("div",{class:"legend-color",style:Le({backgroundColor:E.color})},null,4),l("div",Kt,[l("div",Wt,[l("span",{class:"legend-item-name",title:E.name},c(E.name),9,Gt),l("span",Xt,c(E.percentage)+"% ",1)]),l("div",Zt,c(m(p)("%s licenses",E.value.toLocaleString())),1)])],46,Yt))),128))]),l("div",Jt,[l("button",{onClick:g[0]||(g[0]=()=>{Object.keys(C.value).forEach(E=>C.value[E]=!0),X(v)})},c(w.$t("Show All")),1),l("button",{onClick:g[1]||(g[1]=()=>{Object.keys(C.value).forEach(E=>C.value[E]=!1),X(v)})},c(w.$t("Hide All")),1)])])]),_:1})]),l("div",en,[l("div",{class:"fc-usage-statistics-chart",ref_key:"chartRef",ref:k,style:{flex:"1",height:"350px"}},null,512)])])}}},nn=G(tn,[["__scopeId","data-v-7f737d03"]]),an={},ln={class:"p-4 bg-gray-25 rounded dark:bg-primary-500"},sn={class:"flex items-center gap-2 mb-3"},on={class:"right flex flex-col flex-1 gap-2"};function rn(a,t){const s=u("el-skeleton-item"),k=u("el-skeleton");return o(),h(T,null,H(4,r=>e(k,{animated:"",key:r},{template:n(()=>[l("div",ln,[l("div",sn,[e(s,{variant:"p",class:"rounded w-10 h-10 block"}),l("div",on,[e(s,{variant:"p",class:"rounded w-4/5 block"}),e(s,{variant:"p",class:"rounded w-1/2 block"})])]),l("div",null,[e(s,{variant:"p",class:"rounded w-2/3 block"})])])]),_:2},1024)),64)}const cn=G(an,[["render",rn]]),dn={name:"LicensesStatsCard",props:{licenseOverview:{type:Object,required:!0},loading:{type:Boolean}},components:{DynamicIcon:Y,LicenseStatLoader:cn},methods:{translate:p}},un={class:"licenses-stats-card-head"},_n={class:"licenses-icon"},mn={class:"licenses-stats-card-head-content"},pn={class:"title"},hn={class:"value"},fn={class:"text"};function gn(a,t,s,k,r,i){const S=u("LicenseStatLoader"),C=u("DynamicIcon");return s.loading?(o(),$(S,{key:0})):(o(!0),h(T,{key:1},H(s.licenseOverview,(b,D)=>(o(),h("div",{class:oe(`licenses-stats-card ${D}`),key:D},[l("div",un,[l("div",_n,[e(C,{name:b.icon},null,8,["name"])]),l("div",mn,[l("div",pn,c(i.translate(b.title)),1),l("div",hn,c(b.value),1)])]),l("div",fn,c(i.translate(b.text)),1)],2))),128))}const vn=G(dn,[["render",gn]]),bn={name:"LicenseStats",props:{licenses:{type:Array,required:!0}},components:{DynamicIcon:Y,CardBody:B,CardHeader:R,CardContainer:F,LicenseStatistics:Bt,UsageStatistics:nn,LicensesStatsCard:vn},data(){return{loading:!1,licenseSummary:{}}},methods:{translate:p,fetchSummary(){this.loading=!0,this.$get("reports/license-summary",{params:{start_date:Z().startOf("month").format("YYYY-MM-DD"),end_date:Z().format("YYYY-MM-DD")}}).then(a=>{this.licenseSummary=a.summaryData}).catch(a=>{this.handleError(a)}).finally(()=>{this.loading=!1})}},computed:{totalLicensedProducts(){var a;return((a=this.licenseSummary)==null?void 0:a.totalLicensedProducts)||0},totalActivatedSites(){var a;return((a=this.licenseSummary)==null?void 0:a.totalActivatedSites)||0},totalActiveLicense(){var a;return((a=this.licenseSummary)==null?void 0:a.totalActiveLicense)||this.licenses.filter(t=>t.status==="active").length},totalExpiredLicense(){var a;return((a=this.licenseSummary)==null?void 0:a.totalExpiredLicense)||this.licenses.filter(t=>t.status==="expired").length},totalInactiveLicense(){var a;return((a=this.licenseSummary)==null?void 0:a.totalInactiveLicense)||this.licenses.filter(t=>t.status==="inactive").length},licenseOverview(){return{"license-product":{title:"Licensed Product",value:this.totalLicensedProducts,text:`Active License ${this.totalActiveLicense}`,icon:"LicensedProduct"},"total-active":{title:"Total Active",value:this.totalActiveLicense,text:`New Active License ${this.totalActiveLicense}`,icon:"CheckCircle"},"total-expired":{title:"Total Expired",value:this.totalExpiredLicense,text:`New Expired License ${this.totalExpiredLicense}`,icon:"Warning"},"inactive-license":{title:"Inactive License",value:this.totalInactiveLicense,text:"Individual Sites",icon:"LicensedInactive"}}}},mounted(){this.fetchSummary()}},yn={class:"fc-license-stats-wrap"},wn={class:"licenses-stats-row"},kn={class:"fc-usage-statistics-wrap"};function Ln(a,t,s,k,r,i){const S=u("CardHeader"),C=u("LicensesStatsCard"),b=u("CardBody"),D=u("CardContainer"),V=u("LicenseStatistics"),y=u("el-col"),P=u("el-skeleton"),v=u("UsageStatistics"),I=u("el-row");return o(),h("div",yn,[e(D,null,{default:n(()=>[e(S,{title:i.translate("Overall License Stats"),border_bottom:"",title_size:"small"},null,8,["title"]),e(b,null,{default:n(()=>[l("div",wn,[e(C,{licenseOverview:i.licenseOverview,loading:r.loading},null,8,["licenseOverview","loading"])])]),_:1})]),_:1}),e(I,{gutter:30},{default:n(()=>[e(y,{md:24,lg:16},{default:n(()=>[e(V)]),_:1}),e(y,{md:24,lg:8},{default:n(()=>[e(D,null,{default:n(()=>[e(S,{title:i.translate("Usage Statistics"),border_bottom:"",title_size:"small"},null,8,["title"]),e(b,null,{default:n(()=>[l("div",kn,[r.loading?(o(),$(P,{key:0,animated:"",rows:4})):(o(),$(v,{key:1,activatedSites:i.totalActivatedSites},null,8,["activatedSites"]))])]),_:1})]),_:1})]),_:1})]),_:1})])}const Cn=G(bn,[["render",Ln]]),Sn={class:"table-cell"},Dn={class:"w-full flex flex-col items-start justify-start gap-1"},xn={class:"table-cell"},$n={class:"w-full flex flex-col items-start justify-start gap-1"},Vn={class:"table-cell"},En={class:"table-cell"},An={class:"table-cell"},Pn={__name:"LicensesLoader",props:{nextPageCount:{type:Number,default:0},licenseTable:{type:Object,default:()=>({})}},setup(a){const t=a,s=r=>t.licenseTable.columns.includes(r),k=Array.from({length:t.nextPageCount},(r,i)=>i+1);return(r,i)=>{const S=u("el-table-column"),C=u("el-skeleton-item"),b=u("el-table"),D=u("el-skeleton");return o(),$(D,{animated:""},{template:n(()=>[e(b,{data:m(k),class:"w-full compact-table responsive"},{empty:n(()=>i[0]||(i[0]=[])),default:n(()=>[L("",!0),e(S,{label:r.$t("License Key"),width:220},{default:n(()=>[l("div",Sn,[l("div",Dn,[e(C,{varient:"p",class:"w-1/5"}),e(C,{varient:"p",class:"w-3/5"})])])]),_:1},8,["label"]),s("product")!==-1?(o(),$(S,{key:1,width:200,label:r.$t("Product")},{default:n(()=>[l("div",xn,[l("div",$n,[e(C,{varient:"p",class:"w-1/5"}),e(C,{varient:"p",class:"w-2/5"})])])]),_:1},8,["label"])):L("",!0),s("order_id")!==-1?(o(),$(S,{key:2,width:80,label:r.$t("Order ID")},{default:n(()=>[l("div",Vn,[e(C,{varient:"p",class:"w-3/5"})])]),_:1},8,["label"])):L("",!0),s("customer")!==-1?(o(),$(S,{key:3,width:100,label:r.$t("Customer")},{default:n(()=>[l("div",En,[e(C,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])):L("",!0),e(S,{width:"100",label:r.$t("Activations")},{default:n(()=>[l("div",An,[e(C,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})}}},Tn={},Un={class:"px-4 py-3"},Mn={class:"grid grid-cols-3 gap-5 mt-5"};function In(a,t){const s=u("el-skeleton-item"),k=u("el-skeleton");return o(),$(k,{animated:""},{template:n(()=>[l("div",Un,[(o(),h(T,null,H(2,r=>l("div",{key:r,class:"flex items-center justify-between mb-3"},[e(s,{varient:"p",class:"w-1/2"}),e(s,{varient:"p",class:"w-[100px]"})])),64)),l("div",Mn,[(o(),h(T,null,H(3,r=>l("div",{key:r},[e(s,{varient:"p",class:"w-1/2"}),e(s,{varient:"p",class:"w-[100px]"})])),64))])])]),_:1})}const On=G(Tn,[["render",In]]),Bn={name:"LicenseTableMobile",components:{ProductInfo:qe,UserCan:se,RouteCell:Ue,DynamicIcon:Y,IconButton:de,CopyToClipboard:ue,Empty:me,Badge:W},props:{licenses:{type:Array,required:!0},columns:{type:Array,default(){return["product","order_id","customer","date"]}},emptyText:{type:String,default:p("No Licenses found based on your filter")}},computed:{Clipboard(){return Ze},formattedLicense(){return this.licenses.map(a=>{var t;return{...a,product:{...a.product,variation_title:((t=a.product_variant)==null?void 0:t.variation_title)||"n/a"}}})}},methods:{translate:p,formatDate:Q}},Fn={class:"fc-table-mobile-wrap fc-licenses-table-mobile"},Nn=["onClick"],Rn={class:"fc-table-status-col"},Hn={key:0,class:"fc-table-date-col"},zn={key:0},jn={key:1},qn={class:"fc-table-mobile-body"},Yn=["onClick"],Kn={class:"fc-license-key-wrap has-bg"},Wn={class:"fc-license-key"},Gn={class:"fc-license-key-inner pr-2"},Xn={class:"fc-table-mobile-footer"},Zn={class:"fc-table-mobile-footer-row"},Jn={key:0,class:"fc-table-id-col"},Qn={class:"title"},ea={key:1,class:"fc-table-customer-col"},ta={class:"title"},na={class:"fc-table-activations-col"},aa={class:"title"},la={key:0,class:"py-6 text-center"};function sa(a,t,s,k,r,i){const S=u("Badge"),C=u("ProductInfo"),b=u("router-link"),D=u("DynamicIcon"),V=u("el-tooltip"),y=u("Empty"),P=u("UserCan");return o(),$(P,{permission:"licenses/view"},{default:n(()=>[l("div",Fn,[(o(!0),h(T,null,H(i.formattedLicense,(v,I)=>(o(),h("div",{key:v.id,class:"fc-table-mobile-row"},[l("div",{class:"fc-table-mobile-header",onClick:f=>a.$router.push({name:"view_license",params:{license_id:v==null?void 0:v.id}})},[l("div",Rn,[(o(),$(S,{status:v.status,key:v.id},null,8,["status"]))]),s.columns.indexOf("date")!==-1?(o(),h("div",Hn,[l("span",null,c(i.formatDate(v.created_at)),1),t[0]||(t[0]=l("span",{class:"px-1"},"-",-1)),v.expiration_date?(o(),h("span",zn,c(i.formatDate(v.expiration_date)),1)):(o(),h("span",jn,c(i.translate("Lifetime")),1))])):L("",!0)],8,Nn),l("div",qn,[s.columns.indexOf("product")!==-1?(o(),h("div",{key:0,class:"fc-table-product-col",onClick:f=>a.$router.push({name:"view_license",params:{license_id:v==null?void 0:v.id}})},[e(C,{product:v.product,hideProductId:!0,hideViewIcon:!0,hideImage:!0},null,8,["product"])],8,Yn)):L("",!0),l("div",Kn,[l("div",Wn,[l("div",Gn,[e(b,{class:"link",to:{name:"view_license",params:{license_id:v==null?void 0:v.id}}},{default:n(()=>[x(c(v.license_key),1)]),_:2},1032,["to"])]),e(V,{content:v.license_key,placement:"top","popper-class":"fc-tooltip"},{default:n(()=>[e(D,{class:"cursor-pointer p-1 w-6 h-6",name:"Copy",onClick:()=>{i.Clipboard.copy(v.license_key,{successMessage:i.translate("License Key copied to clipboard"),errorMessage:i.translate("Failed to copy License Key")})}},null,8,["onClick"])]),_:2},1032,["content"])])])]),l("div",Xn,[l("div",Zn,[s.columns.indexOf("order_id")!==-1?(o(),h("div",Jn,[l("div",Qn,c(i.translate("Order ID")),1),e(b,{class:"value",to:{name:"view_order",params:{order_id:v.order_id}}},{default:n(()=>[x(" #"+c(v.order_id),1)]),_:2},1032,["to"])])):L("",!0),s.columns.indexOf("customer")!==-1?(o(),h("div",ea,[l("div",ta,c(i.translate("Customer")),1),e(b,{class:"value",to:{name:"view_customer",params:{customer_id:v.customer_id}}},{default:n(()=>{var f;return[x(c(((f=v==null?void 0:v.customer)==null?void 0:f.full_name)||i.translate("No Name")),1)]}),_:2},1032,["to"])])):L("",!0),l("div",na,[l("div",aa,c(i.translate("Activations")),1),e(b,{class:"value",to:{name:"view_license",params:{license_id:v==null?void 0:v.id}}},{default:n(()=>[x(c(v.activation_count)+" "+c("/")+" "+c(v.limit===0?"Unlimited":v.limit),1)]),_:2},1032,["to"])])])])]))),128)),i.formattedLicense.length===0?(o(),h("div",la,[e(y,{icon:"Empty/ListView","has-dark":"",text:s.emptyText},null,8,["text"])])):L("",!0)])]),_:1})}const ia=G(Bn,[["render",sa]]),oa={class:"fc-all-license-page fc-layout-width"},ra={class:"fc-all-license-wrap"},ca={key:1},da={__name:"Licenses",setup(a){const t=$t(),s=O(!1),k=O(!1),r=()=>{k.value=window.innerWidth<768},i=C=>{C==="show_license_stats"&&(Se.set("show_license_stats",!s.value),s.value=!s.value)},S=()=>{const C=Se.get("show_license_stats");C&&(s.value=C)};return ce(()=>{S(),r(),window.addEventListener("resize",r)}),_e(()=>{window.removeEventListener("resize",r)}),(C,b)=>{const D=u("el-icon"),V=u("el-button"),y=u("el-dropdown-item"),P=u("el-dropdown-menu"),v=u("el-dropdown");return o(),h("div",oa,[e(Me,{title:m(p)("Licenses")},{action:n(()=>[e(se,{permission:"reports/view"},{default:n(()=>[e(v,{trigger:"click","popper-class":"fc-dropdown",onCommand:i,placement:"bottom-end"},{dropdown:n(()=>[e(P,null,{default:n(()=>[e(y,{command:"show_license_stats"},{default:n(()=>[s.value?(o(),h(T,{key:1},[e(Y,{name:"EyeOff"}),x(" "+c(m(p)("Hide License Stats")),1)],64)):(o(),h(T,{key:0},[e(Y,{name:"Eye"}),x(" "+c(m(p)("Show License Stats")),1)],64))]),_:1})]),_:1})]),default:n(()=>[e(V,null,{default:n(()=>[x(c(m(p)("More actions"))+" ",1),e(D,null,{default:n(()=>[e(m(He))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["title"]),e(se,{permission:"reports/view"},{default:n(()=>[s.value?(o(),$(Cn,{key:0,licenses:m(t).getTableData()},null,8,["licenses"])):L("",!0)]),_:1}),e(se,{permission:"licenses/view"},{default:n(()=>[l("div",ra,[e(Ie,{table:m(t),classicTabStyle:!0,"has-mobile-slot":!0},{mobile:n(()=>[m(t).isLoading()?(o(),$(On,{key:0})):L("",!0),m(t).isLoading()?L("",!0):(o(),$(ia,{key:1,licenses:m(t).getTableData(),columns:m(t).data.columns},null,8,["licenses","columns"]))]),default:n(()=>[m(t).isLoading()?(o(),$(Pn,{key:0,licenseTable:m(t),"next-page-count":m(t).nextPageCount},null,8,["licenseTable","next-page-count"])):(o(),h("div",ca,[e(Ye,{licenses:m(t).getTableData(),columns:m(t).data.columns},null,8,["licenses","columns"])]))]),_:1},8,["table"])])]),_:1})])}}},ua={class:"el-form--label-top fc-plan-changer-content-wrap"},_a={key:0},ma=["innerHTML"],pa={key:1},ha=["innerHTML"],fa={key:1,class:"fc-btn-group"},ga={__name:"PlanChanger",props:{variations:{},product_id:"",variation_id:"",license:null,order:null,upgrade_path_base:""},setup(a){const t=a,s=O(!1),k=()=>{s.value=!0},r=Ee().ctx,i=O(""),S=O([]);let C=O(null);const b=ee(()=>{var _,d,w,g;return(d=(_=window.fluentCartAdminApp)==null?void 0:_.shop)!=null&&d.currency_sign?window.fluentCartAdminApp.shop.currency_sign:(g=(w=window.fluentcart_customer_profile_vars)==null?void 0:w.shop)!=null&&g.currency_sign?window.fluentcart_customer_profile_vars.shop.currency_sign:""}),D=ee(()=>{var _;return(_=t.order)==null?void 0:_.order_items.find(d=>d.payment_type==="subscription"||d.payment_type==="adjustment"||d.payment_type==="onetime")}),V=function(_){let d="";const w=_==null?void 0:_.payment_type,g=_==null?void 0:_.other_info;if((g==null?void 0:g.payment_type)==="subscription"&&w!=="adjustment"){(g==null?void 0:g.manage_setup_fee)==="yes"&&(d+=g.signup_fee_name+" : "+b.value+parseFloat(g.signup_fee/100)+", ");const M=Number(g==null?void 0:g.times)?(g==null?void 0:g.times)+" times":", Until Cancel";return d+=(_==null?void 0:_.formatted_total)+" Subscriptions "+g.repeat_interval+" "+M,d}else if((g==null?void 0:g.payment_type)==="subscription"&&w==="adjustment"){(g==null?void 0:g.manage_setup_fee)==="yes"&&(d+=g.signup_fee_name+" :"+parseFloat(g.signup_fee/100)+", ");const M=Number(g==null?void 0:g.times)?(g==null?void 0:g.times)+" times":", Until Cancel";return d+=(_==null?void 0:_.formatted_total)+" Subscriptions "+g.repeat_interval+" "+M,d}else if((g==null?void 0:g.payment_type)==="onetime")return d+=(_==null?void 0:_.formatted_total)+" One Time Payment";return _==null?void 0:_.other_info.billing_summary};let y=O("");const P=_=>{C=t.variations.find(d=>d.id.toString()===_),y.value=V(C)},v=_=>{var w,g;return((w=_==null?void 0:_.other_info)==null?void 0:w.payment_type)==="subscription"?(_==null?void 0:_.variation_title)+" - "+Je.capitalize((g=_==null?void 0:_.other_info)==null?void 0:g.repeat_interval):(_==null?void 0:_.variation_title)+" - One Time Payment"},I=()=>{r.$get(`products/${t.product_id}/upgrade-paths`,{variation_id:t.variation_id}).then(_=>{_.data.forEach((d,w)=>{d.object_id===t.variation_id&&d.value.to_variants.forEach((g,M)=>{S.value.push({id:g,variation_title:v(t.variations.find(E=>E.id.toString()===g)),payment_type:d.payment_type,is_prorate:d.value.is_prorate,discount_amount:d.value.discount_amount})})})})},f=_=>{let d=_.discount_amount;return d>0?_.variation_title+" - "+(_.is_prorate.toString()==="1"?"( Prorated )":"(Full Charge Applies)")+" ( "+d+b.value+" discount )":_.variation_title+" - "+(_.is_prorate.toString()==="1"?"( Prorated )":"(Full Charge Applies)")};ce(()=>{I()});const U=()=>{if(i.value){const _=new URL(t.upgrade_path_base);return _.searchParams.append("order_hash",t.order.uuid),_.searchParams.append("mode","upgrade_plan"),_.searchParams.append("variation_id",i.value),_.href}return!1};return(_,d)=>{const w=u("el-button"),g=u("el-option"),M=u("el-select"),E=u("el-form-item"),J=u("el-dialog");return S.value.length>0&&D.value?(o(),h(T,{key:0},[e(w,{class:"el-button--x-small",onClick:k,type:"primary"},{default:n(()=>[x(c(_.$t("Change Plan")),1)]),_:1}),e(J,{modelValue:s.value,"onUpdate:modelValue":d[1]||(d[1]=K=>s.value=K),title:_.$t("Change Plan"),"append-to-body":!0},{default:n(()=>[l("div",ua,[S.value.length>0?(o(),$(E,{key:0,label:_.$t("Change Plan to")},{default:n(()=>[e(M,{modelValue:i.value,"onUpdate:modelValue":d[0]||(d[0]=K=>i.value=K),onChange:P,clearable:""},{default:n(()=>[(o(!0),h(T,null,H(S.value,K=>(o(),$(g,{key:K.id,label:f(K),value:K.id.toString()},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):L("",!0),e(E,{label:_.$t("New Plan")},{default:n(()=>[m(y)?(o(),h("span",_a,[l("span",{innerHTML:m(y),class:"fc-plan-changer-text"},null,8,ma)])):(o(),h("span",pa,"---"))]),_:1},8,["label"]),e(E,{label:_.$t("Current Plan")},{default:n(()=>[l("span",{innerHTML:V(D.value),class:"fc-plan-changer-text"},null,8,ha)]),_:1},8,["label"]),U()?(o(),h("div",fa,[e(w,{type:"primary",tag:"a",href:U(),target:"_blank",rel:"noopener noreferrer",size:"small"},{default:n(()=>[x(c(_.$t(" Upgrade to New Plan")),1)]),_:1},8,["href"]),e(ue,{showMode:"basic_copy_btn",text:U()},null,8,["text"])])):L("",!0)])]),_:1},8,["modelValue","title"])],64)):L("",!0)}}},va={name:"UpgradePlan",components:{CopyToClipboard:ue,DynamicIcon:Y},props:{variation_id:{type:[String,Number],required:!0},is_admin:{type:Boolean,required:!1,default:!1},product_id:{type:[String,Number],required:!0},order:{type:Object,required:!0},has_upgrades:{type:Boolean,required:!0},props_variations:{type:[Array,Object],required:!0},endpoint_path:{type:String,default:"products"},appendToBody:{type:Boolean,default:!0}},data(){return{variations:this.props_variations,upgradePlanModal:!1,selectedUpgradePath:"",upgradePaths:[]}},computed:{currencySign(){var a,t,s,k;return(t=(a=window.fluentCartAdminApp)==null?void 0:a.shop)!=null&&t.currency_sign?window.fluentCartAdminApp.shop.currency_sign:(k=(s=window.fluentcart_customer_profile_vars)==null?void 0:s.shop)!=null&&k.currency_sign?window.fluentcart_customer_profile_vars.shop.currency_sign:""}},methods:{translate:p,showUpgradePlanModal(){xe.get(`${this.endpoint_path}/variation/${this.variation_id}/upgrade-paths`,{params:{variation_id:this.variation_id,order_hash:this.order.uuid}}).then(a=>{this.upgradePaths=a.upgradePaths,this.upgradePlanModal=!0})},closeUpgradePlanModal(){this.upgradePlanModal=!1}}},ba={class:"fc-upgrade-plan"},ya={key:0,class:"fc-upgrade-variation-table"},wa={class:"upgrade-title"},ka={class:"plan-price"},La={class:"plan-price"},Ca={class:"upgrade-cost"},Sa={class:"upgrade-title"},Da=["innerHTML"],xa={key:0,class:"upgrade-text"},$a={class:"upgrade-action"},Va={key:1};function Ea(a,t,s,k,r,i){const S=u("el-button"),C=u("el-table-column"),b=u("el-table"),D=u("el-dialog");return o(),h("div",ba,[s.has_upgrades?(o(),$(S,{key:0,size:"small",onClick:i.showUpgradePlanModal},{default:n(()=>[x(c(a.$t("Upgrade")),1)]),_:1},8,["onClick"])):L("",!0),e(D,{modelValue:r.upgradePlanModal,"onUpdate:modelValue":t[0]||(t[0]=V=>r.upgradePlanModal=V),"append-to-body":s.appendToBody,title:a.$t("Upgrade"),class:"fc-upgrade-plan-dialog fluent-cart-customer-profile-app"},{default:n(()=>[r.upgradePaths.length>0?(o(),h("div",ya,[e(b,{data:r.upgradePaths,style:{width:"100%"}},{default:n(()=>[e(C,{label:a.$t("Package"),width:290},{default:n(V=>[l("div",wa,c(V.row.title),1)]),_:1},8,["label"]),e(C,{label:a.$t("Price"),width:100},{default:n(V=>[l("div",ka,[l("div",La,c(a.formatNumber(V.row.price,s.order.currency)),1)])]),_:1},8,["label"]),e(C,{label:a.$t("Amount to pay")},{default:n(V=>[l("div",Ca,[l("div",Sa,[l("span",{innerHTML:V.row.payment_summary},null,8,Da),V.row.prorate_credit?(o(),h("div",xa)):L("",!0)])])]),_:1},8,["label"]),e(C,{label:a.$t("Action"),width:110},{default:n(V=>[l("div",$a,[e(S,{class:"el-button--x-small",tag:"a",href:V.row.upgrade_url,target:"_blank"},{default:n(()=>[x(c(a.$t("Upgrade")),1)]),_:2},1032,["href"])])]),_:1},8,["label"])]),_:1},8,["data"])])):(o(),h("div",Va,c(a.$t("No upgrade plan found")),1))]),_:1},8,["modelValue","append-to-body","title"])])}const Aa=G(va,[["render",Ea]]),Pa={name:"LicenseInformation",components:{Badge:W,CopyToClipboard:ue,DynamicIcon:Y,IconButton:de,PlanChanger:ga,UpgradePlan:Aa},props:{license:"license",customerId:"customerId",license_id:"license_id",activations:"activations",product:null,order:null,upgrade_path_base:""},data(){return{isDateSelected:!1,isCalendarOpen:!1,selectedDate:null,loading:!1,isConfirmationIconEnable:!1,limit:this.license.limit,variations:[],variation_id:this.license.variation_id+"",licenseLifetime:!1,isExpirationDateEnable:!1,isActivationLimitEnable:!1}},watch:{product:{handler(){var a;(a=this.product)!=null&&a.variants&&(this.variations=this.product.variants)},deep:!0,immediate:!0}},methods:{translate:p,formatDate:Q,handleToggleExpirationDate(){this.isExpirationDateEnable=!this.isExpirationDateEnable},handleToggleActivationLimit(){this.isActivationLimitEnable=!this.isActivationLimitEnable},handleLifetimeLicense(){this.$confirm(this.$t("Are you sure you want to mark license as lifetime?"),this.$t("Confirm!"),{cancelButtonText:this.$t("No,Thanks"),confirmButtonText:this.$t("Confirm"),type:"warning"}).then(()=>{this.markAsLifetime()}).catch(()=>{this.licenseLifetime=!1})},handleActivationLimit(){this.$confirm(this.$t("Are you sure you want to mark limit as unlimited?"),this.$t("Confirm!"),{cancelButtonText:this.$t("No,Thanks"),confirmButtonText:this.$t("Confirm"),type:"warning"}).then(()=>{this.markAsUnlimited()}).catch(()=>{})},handleDateChange(){this.newExpirationDate=Z(this.selectedDate).format("YYYY-MM-DD HH:mm:ss"),this.extendValidity()},handleLimitChange(){this.isConfirmationIconEnable=!0},markAsLifetime(){this.licenseLifetime=!0,this.newExpirationDate="lifetime",this.extendValidity()},markAsUnlimited(){this.activationLimitUnlimited=!0,this.limit="unlimited",this.updateLimit()},regenerateLicenseKey(){this.$post("licensing/licenses/"+this.license_id+"/regenerate-key").then(a=>{this.$emit("fetchLicense"),this.handleSuccess(a.message)}).catch(a=>{this.handleError(a)}).finally(()=>{this.loading=!1})},extendValidity(){this.$post("licensing/licenses/"+this.license_id+"/extend-validity",{expiration_date:this.newExpirationDate}).then(a=>{this.newExpirationDate=null,this.$emit("fetchLicense"),this.handleSuccess(a.message),this.selectedDate=null,this.licenseLifetime=!0}).catch(a=>{this.handleError(a),this.licenseLifetime=!1}).finally(()=>{this.loading=!1})},updateLimit(){this.$post("licensing/licenses/"+this.license_id+"/update_limit",{limit:this.limit}).then(a=>{this.$emit("fetchLicense"),this.handleSuccess(a.message),this.isConfirmationIconEnable=!1}).catch(a=>{this.handleError(a),this.isConfirmationIconEnable=!1}).finally(()=>{this.loading=!1})},resetLimit(){this.limit=this.license.limit,this.isConfirmationIconEnable=!1}},mounted(){var t;const a=(t=this.$refs.calendar)==null?void 0:t.$el.querySelector("input");a&&a.addEventListener("keydown",s=>{s.key==="Enter"&&this.handleDateChange()})}},Ta={class:"fc-license-info-content"},Ua={class:"flex items-center gap-2"},Ma={class:"fc-input-with-action-wrap"},Ia={class:"fc-input-with-action"},Oa={class:"fc-license-product"},Ba={class:"text-xs"},Fa={class:"fc-license-inline-action-wrap"},Na={key:1,class:"text"},Ra={key:2,class:"separator"},Ha={class:"inline-action-button"},za={class:"text"},ja={class:"fc-license-inline-action-wrap"},qa={key:0,class:"inline-action-input-group mr-2"},Ya={key:0,class:"fc-license-activation-limit-actions"},Ka={key:1,class:"text"},Wa={key:2,class:"separator"},Ga={class:"inline-action-button"},Xa={class:"text"},Za={class:"fc-license-info-form-show-on-mobile"},Ja={class:"fc-license-info-mobile-header"},Qa={class:"fc-license-info-mobile-body"},el={class:"fc-license-product"},tl={class:"text-xs text-system-mid dark:text-gray-300"},nl={class:"fc-input-with-action-wrap"},al={class:"fc-input-with-action"},ll={class:"fc-input-with-action-icon"},sl={class:"fc-license-info-mobile-footer"},il={class:"fc-license-info-mobile-footer-item"},ol={class:"title"},rl={class:"fc-license-inline-action-wrap"},cl={key:1,class:"text"},dl={key:2,class:"separator"},ul={class:"inline-action-button"},_l={class:"text"},ml={class:"fc-license-info-mobile-footer-item"},pl={class:"title"},hl={class:"fc-license-inline-action-wrap"},fl={key:0,class:"inline-action-input-group mr-2"},gl={key:0,class:"fc-license-activation-limit-actions"},vl={key:1,class:"text"},bl={key:2,class:"separator"},yl={class:"inline-action-button"},wl={class:"text"};function kl(a,t,s,k,r,i){var M,E,J,K,pe,he,fe,ge,ve;const S=u("CopyToClipboard"),C=u("el-input"),b=u("DynamicIcon"),D=u("el-button"),V=u("el-popconfirm"),y=u("el-form-item"),P=u("el-col"),v=u("router-link"),I=u("UpgradePlan"),f=u("el-date-picker"),U=u("el-input-number"),_=u("IconButton"),d=u("el-row"),w=u("el-form"),g=u("Badge");return o(),h("div",Ta,[e(w,{class:"fc-license-info-form-hide-on-mobile",model:s.license,"label-position":"top"},{default:n(()=>[e(d,null,{default:n(()=>[e(P,{lg:24},{default:n(()=>[e(y,{label:""},{label:n(()=>[l("div",Ua,[x(c(i.translate("License Key"))+" ",1),e(S,{text:s.license.license_key,showMode:"basic_copy_btn",tooltipText:i.translate("Copy License")},null,8,["text","tooltipText"])])]),default:n(()=>[l("div",Ma,[e(C,{modelValue:s.license.license_key,"onUpdate:modelValue":t[0]||(t[0]=A=>s.license.license_key=A),disabled:""},null,8,["modelValue"]),l("div",Ia,[e(V,{width:"250","confirm-button-text":i.translate("Confirm"),"cancel-button-text":i.translate("No, Thanks"),title:i.translate("Are you sure to regenerate?"),onConfirm:i.regenerateLicenseKey},{reference:n(()=>[e(D,{class:"el-button--x-small",plain:""},{default:n(()=>[e(b,{name:"Reload"}),x(" "+c(i.translate("Regenerate")),1)]),_:1})]),_:1},8,["confirm-button-text","cancel-button-text","title","onConfirm"])])])]),_:1})]),_:1}),e(P,{lg:24},{default:n(()=>[s.product!=null?(o(),$(y,{key:0,label:i.translate("Product Name")},{default:n(()=>{var A;return[l("div",Oa,[e(v,{class:"link",to:{name:"product_edit",params:{product_id:s.product.ID}}},{default:n(()=>{var z;return[x(c(s.product.post_title)+" ",1),l("span",Ba," â€“ "+c((z=r.variations.find(le=>le.id==s.license.variation_id))==null?void 0:z.variation_title),1)]}),_:1},8,["to"]),((A=r.variations)==null?void 0:A.length)>0?(o(),$(I,{key:0,variation_id:r.variation_id,product_id:s.product.ID,order:s.order,props_variations:r.variations,endpoint_path:"products",has_upgrades:s.license.has_upgrades&&!["expired","disabled"].includes(s.license.status),is_admin:!0},null,8,["variation_id","product_id","order","props_variations","has_upgrades"])):L("",!0)])]}),_:1},8,["label"])):L("",!0)]),_:1}),e(P,{lg:12},{default:n(()=>[e(y,{label:i.translate("Purchase Date")},{default:n(()=>{var A;return[l("span",null,c(i.formatDate((A=s.license)==null?void 0:A.created_at)),1)]}),_:1},8,["label"])]),_:1}),e(P,{lg:12},{default:n(()=>[e(y,{label:i.translate("Expirations date")},{default:n(()=>{var A,z,le,be,ye,we;return[l("div",Fa,[r.isExpirationDateEnable?(o(),$(f,{key:0,modelValue:r.selectedDate,"onUpdate:modelValue":t[1]||(t[1]=te=>r.selectedDate=te),placeholder:i.formatDate((A=s.license)==null?void 0:A.expiration_date)?i.formatDate((z=s.license)==null?void 0:z.expiration_date):i.translate("Lifetime"),"default-value":(le=s.license)==null?void 0:le.expiration_date,type:"date",ref:"calendar",onChange:i.handleDateChange,class:"el-input--x-small mr-2"},null,8,["modelValue","placeholder","default-value","onChange"])):(o(),h("span",Na,c((be=s.license)!=null&&be.expiration_date?i.formatDate((ye=s.license)==null?void 0:ye.expiration_date):"Lifetime"),1)),r.isExpirationDateEnable?L("",!0):(o(),h("span",Ra)),l("div",Ha,[l("a",{href:"#",onClick:t[2]||(t[2]=j((...te)=>i.handleToggleExpirationDate&&i.handleToggleExpirationDate(...te),["prevent"]))},c(r.isExpirationDateEnable?i.translate("Cancel"):i.translate("Edit")),1),!r.isExpirationDateEnable&&((we=s.license)!=null&&we.expiration_date)?(o(),h(T,{key:0},[l("span",za,c(i.translate("or")),1),l("a",{href:"#",onClick:t[3]||(t[3]=j((...te)=>i.handleLifetimeLicense&&i.handleLifetimeLicense(...te),["prevent"]))},c(i.translate("Mark as lifetime")),1)],64)):L("",!0)])])]}),_:1},8,["label"])]),_:1}),e(P,{lg:12},{default:n(()=>[e(y,{label:i.translate("Activation Limit")},{default:n(()=>{var A;return[l("div",ja,[r.isActivationLimitEnable?(o(),h("div",qa,[e(U,{modelValue:r.limit,"onUpdate:modelValue":t[4]||(t[4]=z=>r.limit=z),min:0,"controls-position":"right",onChange:i.handleLimitChange,onKeyup:i.handleLimitChange},{"decrease-icon":n(()=>[e(b,{class:"w-3",name:"ChevronDown"})]),"increase-icon":n(()=>[e(b,{class:"w-3",name:"ChevronUp"})]),_:1},8,["modelValue","onChange","onKeyup"]),r.isConfirmationIconEnable?(o(),h("div",Ya,[e(_,{tag:"button",onClick:j(i.updateLimit,["prevent"])},{default:n(()=>[e(b,{name:"Check"})]),_:1},8,["onClick"]),e(_,{tag:"button",onClick:j(i.resetLimit,["prevent"])},{default:n(()=>[e(b,{name:"Cross"})]),_:1},8,["onClick"])])):L("",!0)])):L("",!0),r.isActivationLimitEnable?L("",!0):(o(),h("span",Ka,c((A=s.activations)==null?void 0:A.length)+" / "+c(r.limit!=0?r.limit:i.translate("Unlimited")),1)),r.isActivationLimitEnable?L("",!0):(o(),h("span",Wa)),l("div",Ga,[l("a",{href:"#",onClick:t[5]||(t[5]=j((...z)=>i.handleToggleActivationLimit&&i.handleToggleActivationLimit(...z),["prevent"]))},c(r.isActivationLimitEnable?i.translate("Cancel"):i.translate("Edit")),1),!r.isActivationLimitEnable&&r.limit!=0?(o(),h(T,{key:0},[l("span",Xa,c(i.translate("or")),1),l("a",{href:"#",onClick:t[6]||(t[6]=j((...z)=>i.handleActivationLimit&&i.handleActivationLimit(...z),["prevent"]))},c(i.translate("Mark as unlimited")),1)],64)):L("",!0)])])]}),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model"]),l("div",Za,[l("div",Ja,[e(g,{status:s.license.status,size:"small"},null,8,["status"]),l("span",null,c(i.translate("Purchase Date"))+": "+c(i.formatDate((M=s.license)==null?void 0:M.created_at)),1)]),l("div",Qa,[l("div",el,[e(v,{class:"link",to:{name:"product_edit",params:{product_id:s.product.ID}}},{default:n(()=>{var A;return[x(c(s.product.post_title)+" ",1),l("span",tl," â€“ "+c((A=r.variations.find(z=>z.id==s.license.variation_id))==null?void 0:A.variation_title),1)]}),_:1},8,["to"]),((E=r.variations)==null?void 0:E.length)>0?(o(),$(I,{key:0,variation_id:r.variation_id,product_id:s.product.ID,order:s.order,props_variations:r.variations,endpoint_path:"products",has_upgrades:s.license.has_upgrades&&!["expired","disabled"].includes(s.license.status),is_admin:!0},null,8,["variation_id","product_id","order","props_variations","has_upgrades"])):L("",!0)]),l("div",nl,[e(C,{modelValue:s.license.license_key,"onUpdate:modelValue":t[7]||(t[7]=A=>s.license.license_key=A),readonly:""},null,8,["modelValue"]),l("div",al,[e(V,{width:"250","confirm-button-text":i.translate("Confirm"),"cancel-button-text":i.translate("No, Thanks"),title:i.translate("Are you sure to regenerate?"),onConfirm:i.regenerateLicenseKey},{reference:n(()=>[l("div",ll,[e(b,{name:"Reload"})])]),_:1},8,["confirm-button-text","cancel-button-text","title","onConfirm"])])])]),l("div",sl,[l("div",il,[l("div",ol,c(i.translate("Expirations date")),1),l("div",rl,[r.isExpirationDateEnable?(o(),$(f,{key:0,modelValue:r.selectedDate,"onUpdate:modelValue":t[8]||(t[8]=A=>r.selectedDate=A),placeholder:i.formatDate((J=s.license)==null?void 0:J.expiration_date)?i.formatDate((K=s.license)==null?void 0:K.expiration_date):i.translate("Lifetime"),"default-value":(pe=s.license)==null?void 0:pe.expiration_date,type:"date",ref:"calendar",onChange:i.handleDateChange,class:"el-input--x-small mr-2"},null,8,["modelValue","placeholder","default-value","onChange"])):(o(),h("span",cl,c((he=s.license)!=null&&he.expiration_date?i.formatDate((fe=s.license)==null?void 0:fe.expiration_date):"Lifetime"),1)),r.isExpirationDateEnable?L("",!0):(o(),h("span",dl)),l("div",ul,[l("a",{href:"#",onClick:t[9]||(t[9]=j((...A)=>i.handleToggleExpirationDate&&i.handleToggleExpirationDate(...A),["prevent"]))},c(r.isExpirationDateEnable?i.translate("Cancel"):i.translate("Edit")),1),!r.isExpirationDateEnable&&((ge=s.license)!=null&&ge.expiration_date)?(o(),h(T,{key:0},[l("span",_l,c(i.translate("or")),1),l("a",{href:"#",onClick:t[10]||(t[10]=j((...A)=>i.handleLifetimeLicense&&i.handleLifetimeLicense(...A),["prevent"]))},c(i.translate("Mark as lifetime")),1)],64)):L("",!0)])])]),l("div",ml,[l("div",pl,c(i.translate("Activation Limit")),1),l("div",hl,[r.isActivationLimitEnable?(o(),h("div",fl,[e(U,{modelValue:r.limit,"onUpdate:modelValue":t[11]||(t[11]=A=>r.limit=A),min:0,"controls-position":"right",onChange:i.handleLimitChange,onKeyup:i.handleLimitChange},{"decrease-icon":n(()=>[e(b,{class:"w-3",name:"ChevronDown"})]),"increase-icon":n(()=>[e(b,{class:"w-3",name:"ChevronUp"})]),_:1},8,["modelValue","onChange","onKeyup"]),r.isConfirmationIconEnable?(o(),h("div",gl,[e(_,{tag:"button",onClick:j(i.updateLimit,["prevent"])},{default:n(()=>[e(b,{name:"Check"})]),_:1},8,["onClick"]),e(_,{tag:"button",onClick:j(i.resetLimit,["prevent"])},{default:n(()=>[e(b,{name:"Cross"})]),_:1},8,["onClick"])])):L("",!0)])):L("",!0),r.isActivationLimitEnable?L("",!0):(o(),h("span",vl,c((ve=s.activations)==null?void 0:ve.length)+" / "+c(r.limit!=0?r.limit:i.translate("Unlimited")),1)),r.isActivationLimitEnable?L("",!0):(o(),h("span",bl)),l("div",yl,[l("a",{href:"#",onClick:t[12]||(t[12]=j((...A)=>i.handleToggleActivationLimit&&i.handleToggleActivationLimit(...A),["prevent"]))},c(r.isActivationLimitEnable?i.translate("Cancel"):i.translate("Edit")),1),!r.isActivationLimitEnable&&r.limit!=0?(o(),h(T,{key:0},[l("span",wl,c(i.translate("or")),1),l("a",{href:"#",onClick:t[13]||(t[13]=j((...A)=>i.handleActivationLimit&&i.handleActivationLimit(...A),["prevent"]))},c(i.translate("Mark as unlimited")),1)],64)):L("",!0)])])])])])])}const Ll=G(Pa,[["render",kl]]),Cl={name:"ActivatedSiteInformation",props:["activatedSites","modelValue","activationLimit","activationCount"],computed:{Link(){return ze}},components:{IconButton:de,DynamicIcon:Y,Badge:W,Empty:me},methods:{formatDate:Q,updateModelValue(a){this.$emit("update:modelValue",a)},activateSite(){this.$emit("siteActivated")},deactivateSite(a){this.$emit("siteDeactivated",a)}}},Sl={class:"fc-activated-site-url-container grid gap-5"},Dl={key:0,class:"-mx-6 -mb-6 fc-license-site-url-table-wrap"};function xl(a,t,s,k,r,i){const S=u("el-table-column"),C=u("Badge"),b=u("DynamicIcon"),D=u("IconButton"),V=u("el-popconfirm"),y=u("el-table"),P=u("Empty");return o(),h("div",Sl,[s.activatedSites.length>0?(o(),h("div",Dl,[e(y,{data:s.activatedSites,class:"w-full"},{default:n(()=>[e(S,{label:a.$t("Site URL"),width:"360"},{default:n(v=>[l("span",null,c(v.row.site_url),1)]),_:1},8,["label"]),e(S,{label:a.$t("Status"),width:"100"},{default:n(v=>[e(C,{status:v.row.status,size:"small"},null,8,["status"])]),_:1},8,["label"]),e(S,{label:a.$t("Activated at"),width:"140"},{default:n(v=>[l("span",null,c(i.formatDate(v.row.created_at)),1)]),_:1},8,["label"]),e(S,{width:"100"},{default:n(v=>[l("span",null,[e(V,{width:"200","confirm-button-text":a.$t("Confirm"),"cancel-button-text":a.$t("No, Thanks"),title:a.$t("Are you sure?"),onConfirm:I=>i.deactivateSite(v.row.id)},{reference:n(()=>[e(D,{tag:"a",size:"x-small",class:"ml-auto",hover:"danger"},{default:n(()=>[e(b,{name:"TrashIcon"})]),_:1})]),_:2},1032,["confirm-button-text","cancel-button-text","title","onConfirm"])])]),_:1})]),_:1},8,["data"])])):(o(),$(P,{key:1,icon:"Empty/ListView","has-dark":!0,text:a.$t("No activated sites found")},null,8,["text"]))])}const $l=G(Cl,[["render",xl]]),Vl={class:"fc-single-customer-loader-wrap fc-layout-width"},El={class:"single-page-header fc-page-loader-header flex items-start justify-between"},Al={class:"single-page-body"},Pl={class:"fc-single-order"},Tl={class:"fc-single-order-main"},Ul={class:"grid gap-5 grid-cols-[repeat(auto-fit,minmax(200px,1fr))]"},Ml={class:"fc-single-order-aside"},Il={class:"fc-admin-sidebar"},Ol={__name:"SingleLicenseLoader",setup(a){return(t,s)=>{const k=u("el-skeleton-item"),r=u("el-skeleton");return o(),h("div",Vl,[l("div",El,[e(r,{animated:"",class:"flex items-start gap-2"},{template:n(()=>[(o(),h(T,null,H(3,i=>e(k,{key:i,class:"max-w-[100px]"})),64))]),_:1})]),l("div",Al,[l("div",Pl,[l("div",Tl,[e(F,{class:"overflow-hidden"},{default:n(()=>[e(R,{border_bottom:"",title_size:"small",title:t.$t("Manage License Details")},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:!0,class:"mb-5"},{template:n(()=>[e(k,{variant:"p",class:"w-full"}),e(k,{variant:"p",style:{width:"50%"}})]),_:1}),l("div",Ul,[(o(),h(T,null,H(6,i=>e(r,{key:i,animated:!0},{template:n(()=>[l("div",null,[e(k,{variant:"p",class:"w-full"}),e(k,{variant:"p",style:{width:"50%"}})])]),_:2},1024)),64))])]),_:1})]),_:1}),e(F,{class:"overflow-hidden"},{default:n(()=>[e(R,{border_bottom:"",title_size:"small",title:t.$t("Related Orders")},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:!0,class:"mb-5",rows:2})]),_:1})]),_:1}),e(F,{class:"overflow-hidden"},{default:n(()=>[e(R,{border_bottom:"",title_size:"small",title:t.$t("Activated Sites")},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:!0,class:"mb-5",rows:3})]),_:1})]),_:1})]),l("div",Ml,[l("div",Il,[e(F,null,{default:n(()=>[e(R,{title:t.$t("Customer Information"),border_bottom:"",title_size:"small"},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:"",rows:6})]),_:1})]),_:1}),e(F,null,{default:n(()=>[e(R,{title:t.$t("Actions"),border_bottom:"",title_size:"small"},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:""},{template:n(()=>[e(k,{variant:"p",class:"w-1/2"})]),_:1})]),_:1})]),_:1}),e(F,null,{default:n(()=>[e(R,{title:t.$t("Labels"),border_bottom:"",title_size:"small"},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:"",rows:1})]),_:1})]),_:1})])])])])])}}},Bl={key:2,class:"fc-view-license-wrap fc-layout-width"},Fl={class:"single-page-header"},Nl={class:"flex items-center gap-3 flex-wrap whitespace-pre-wrap",style:{"overflow-wrap":"anywhere"}},Rl={class:"license-breadcrumb-only-mobile"},Hl={class:"single-page-body"},zl={class:"fc-view-license-content-wrap"},jl={class:"more-btn"},ql={class:"fc-related-license-content"},Yl={class:"fc-license-related-orders-show-on-mobile fc-table-mobile-wrap"},Kl={class:"fc-table-mobile-header"},Wl={class:"fc-table-date-col"},Gl={class:"fc-table-price-col"},Xl={class:"fc-table-mobile-footer"},Zl={class:"fc-table-mobile-footer-row"},Jl={class:"title"},Ql={class:"fc-table-status-col flex items-center gap-1"},es={class:"title"},ts={class:"value capitalize"},ns={class:"fc-related-license-content"},as={class:"value-column-with-space",style:{"max-height":"500px","overflow-y":"auto"}},ls=["innerHTML"],ss={class:"fc-admin-sidebar"},is={class:"fc-admin-sidebar-item"},os={class:"fc-lists"},rs={class:"!mb-0"},cs={name:"ViewLicense",components:{OrderUpDownIndicator:ie},props:["license_id"],data(){return{changes_made:0,isDateSelected:!1,isCalendarOpen:!1,activeTab:"license",activeMenu:"details",license:null,order:null,selectedDate:null,orders:[],prevOrders:[],activations:[],loading:!0,saving:!1,limit:null,site_url:null,upgrade_path_base:"",showConfirmationIcons:!1,customerId:null,activatedSites:[],logs:[],selectedLabels:[],renewalNoticeValue:"",renewalNoticeOptions:[{value:"option1",label:"Need to connect backend"},{value:"option2",label:"Need to connect backend"}],product:{},notFound:{show:!1,message:"",buttonText:"",route:""}}},watch:{license:{handler(){this.changes_made++},deep:!0,immediate:!0},product:{handler(){var a;(a=this.product)!=null&&a.variants&&(this.variations=this.product.variants)},deep:!0,immediate:!0},license_id:{handler(a,t){this.fetchLicense()}}},methods:{handleLicenseCommand(a){a==="delete_license"&&this.$confirm("Are you sure you want to delete this license?","Confirm Delete!",{confirmButtonText:"Yes, Delete!",cancelButtonText:"Cancel",confirmButtonClass:"el-button--primary",cancelButtonClass:"el-button--info is-plain",type:"warning"}).then(()=>{this.deleteLicense()}).catch(()=>{})},deleteLicense(){this.$del(`licensing/licenses/${this.license_id}/delete`).then(a=>{this.handleSuccess(a.message),this.$router.push({name:"licenses"})}).catch(a=>{this.handleError(a)})},updateUrl(a,t){this.activatedSites[a]=t},activateSite(){Xe(this.site_url)?this.$post("licensing/licenses/"+this.license_id+"/activate_site",{url:this.site_url}).then(t=>{if(this.fetchLicense(),this.site_url=null,t.success)this.handleSuccess("Site activated successfully!");else{let s=t.error??"An error occurred while activating the site";this.handleError(s)}}).catch(t=>{this.handleError(t)}).finally(()=>{this.loading=!1}):this.handleError("Enter a valid site URL")},deactivateSite(a){this.$post("licensing/licenses/"+this.license_id+"/deactivate_site",{activation_id:a}).then(t=>{this.fetchLicense(),this.handleSuccess(t.message)}).catch(t=>{this.handleError(t)}).finally(()=>{this.loading=!1})},fetchLicense(){this.loading=!0,this.notFound.show=!1,this.$get("licensing/licenses/"+this.license_id).then(a=>{var t,s;this.license=a.license,this.order=a.order,this.order.customer=(t=this.license)==null?void 0:t.customer,this.upgrade_path_base=a.upgrade_path_base,this.orders=a.orders,this.activations=a.activations,this.limit=this.license.limit,this.customerId=(s=this.license.customer)==null?void 0:s.id,this.product=a.product,this.selectedLabels=a.selected_labels,this.prevOrders=a.prev_orders,this.activatedSites=this.activations.map(k=>{var r,i;return{id:k.id,site_url:(r=k.site)==null?void 0:r.site_url,created_at:(i=k.site)==null?void 0:i.created_at,status:k.status}}).sort((k,r)=>r.id-k.id)}).catch(a=>{a&&((a==null?void 0:a.code)==="fluent_cart_entity_not_found"?(this.notFound.show=!0,this.notFound.buttonText=ae.get(a,"data.buttonText"),this.notFound.message=ae.get(a,"data.message"),this.notFound.route=ae.get(a,"data.route")):this.handleError(a))}).finally(()=>{this.loading=!1})},fetchLicenseMeta(){this.$get("licensing/licenses/meta/"+this.license_id).then(a=>{this.logs=a}).catch(a=>{this.handleError(a)}).finally(()=>{this.loading=!1})},updateLicenseStatus(a){this.$post("licensing/licenses/"+this.license_id+"/update_status",{status:a}).then(t=>{this.license&&(this.license.status=a),this.$emit("fetchLicense"),this.handleSuccess(t.message),this.fetchLicense()}).catch(t=>{this.handleError(t)}).finally(()=>{this.loading=!1})},getCustomerTotalOrders(a){return a>0?a+" "+(a==1?p("order"):p("orders")):p("No orders")},handleMenuClick(a){this.activeMenu=a},discard(){return window.location.reload()}},mounted(){this.fetchLicense()}},ds=Object.assign(cs,{setup(a){return(t,s)=>{var _;const k=u("el-breadcrumb-item"),r=u("el-breadcrumb"),i=u("router-link"),S=u("el-dropdown-item"),C=u("el-dropdown-menu"),b=u("el-dropdown"),D=u("el-table-column"),V=u("el-table"),y=u("el-timeline-item"),P=u("el-timeline"),v=u("el-col"),I=u("el-button"),f=u("el-popconfirm"),U=u("el-row");return o(),h("div",null,[t.loading?(o(),$(Ol,{key:0})):L("",!0),t.notFound.show?(o(),$(Oe,{key:1,"button-text":t.notFound.buttonText,message:t.notFound.message,route:t.notFound.route},null,8,["button-text","message","route"])):L("",!0),t.notFound.show===!1?(o(),h("div",Bl,[t.loading?L("",!0):(o(),h(T,{key:0},[t.license?(o(),h(T,{key:0},[l("div",Fl,[e(r,{class:"hide-license-breadcrumb-on-mobile","separator-icon":m(je)},{default:n(()=>[e(k,{to:{name:"licenses"}},{default:n(()=>[x(c(m(p)("Licenses")),1)]),_:1}),e(k,null,{default:n(()=>{var d;return[l("div",Nl,[x(c((d=t.license)==null?void 0:d.license_key)+" ",1),e(W,{status:t.license.status,size:"small"},null,8,["status"])])]}),_:1})]),_:1},8,["separator-icon"]),l("ul",Rl,[l("li",null,[e(i,{to:{name:"licenses"}},{default:n(()=>[e(Y,{name:"ArrowLeft",class:"cursor-pointer"})]),_:1})]),l("li",null,c((_=t.license)==null?void 0:_.license_key),1)])]),l("div",Hl,[e(U,{gutter:30},{default:n(()=>[e(v,{lg:17},{default:n(()=>[l("div",zl,[e(F,null,{default:n(()=>[e(R,{border_bottom:"",title_size:"small",title:m(p)("License Details")},{action:n(()=>[e(b,{trigger:"click",class:"fc-more-option-wrap","popper-class":"fc-dropdown",onCommand:t.handleLicenseCommand,placement:"bottom-end"},{dropdown:n(()=>[e(C,null,{default:n(()=>[e(S,{command:"delete_license",class:"item-destructive"},{default:n(()=>[e(Y,{name:"Delete"}),x(" "+c(m(p)("Delete License")),1)]),_:1})]),_:1})]),default:n(()=>[l("span",jl,[e(Y,{name:"More"})])]),_:1},8,["onCommand"])]),_:1},8,["title"]),e(B,null,{default:n(()=>[e(Ll,{license:t.license,customerId:t.customerId,license_id:a.license_id,activations:t.activations,product:t.product,order:t.order,upgrade_path_base:t.upgrade_path_base,onFetchLicense:t.fetchLicense},null,8,["license","customerId","license_id","activations","product","order","upgrade_path_base","onFetchLicense"])]),_:1})]),_:1}),e(F,{class:"overflow-hidden"},{default:n(()=>[e(R,{title:m(p)("Related Orders"),title_size:"small"},null,8,["title"]),e(B,{class:"px-0 pb-0"},{default:n(()=>[l("div",ql,[e(V,{data:t.orders,class:"w-full fc-license-related-orders-hide-on-mobile"},{default:n(()=>[e(D,{width:120,label:m(p)("ID")},{default:n(d=>[e(i,{class:"link",to:{name:"view_order",params:{order_id:d.row.id}}},{default:n(()=>[x(" #"+c(d.row.id),1)]),_:2},1032,["to"])]),_:1},8,["label"]),e(D,{width:120,label:m(p)("Amount")},{default:n(d=>[l("span",null,c(t.formatNumber(d.row.total_paid)),1)]),_:1},8,["label"]),e(D,{width:150,label:m(p)("Date"),prop:"created_at"},{default:n(d=>[l("span",null,c(m(Q)(d.row.created_at)),1)]),_:1},8,["label"]),e(D,{label:m(p)("Payment Method")},{default:n(d=>[x(c(d.row.payment_method),1)]),_:1},8,["label"]),e(D,{label:m(p)("Status")},{default:n(d=>[e(W,{type:d.row.payment_status},{default:n(()=>[x(c(d.row.payment_status),1)]),_:2},1032,["type"]),e(W,{style:{"margin-left":"5px","margin-right":"5px"},type:d.row.type},{default:n(()=>[x(c(d.row.type),1)]),_:2},1032,["type"]),e(ie,{order:d.row},null,8,["order"])]),_:1},8,["label"])]),_:1},8,["data"]),l("div",Yl,[(o(!0),h(T,null,H(t.orders,(d,w)=>(o(),h("div",{key:w,class:"fc-table-mobile-row"},[l("div",Kl,[l("div",Wl,[x(c(m(Q)(d.created_at))+" ",1),s[4]||(s[4]=l("div",{class:"bullet"},"â€¢",-1)),e(i,{class:"link",to:{name:"view_order",params:{order_id:d.id}}},{default:n(()=>[x(" #"+c(d.id),1)]),_:2},1032,["to"])]),l("div",Gl,c(t.formatNumber(d.total_paid)),1)]),l("div",Xl,[l("div",Zl,[l("div",null,[l("div",Jl,c(m(p)("Status")),1),l("div",Ql,[e(W,{type:d.payment_status},{default:n(()=>[x(c(d.payment_status),1)]),_:2},1032,["type"]),e(W,{type:d.type},{default:n(()=>[x(c(d.type),1)]),_:2},1032,["type"]),e(ie,{order:d},null,8,["order"])])]),l("div",null,[l("div",es,c(m(p)("Payment Method")),1),l("div",ts,c(d.payment_method),1)])])])]))),128))])])]),_:1})]),_:1}),t.prevOrders&&t.prevOrders.length?(o(),$(F,{key:0,class:"overflow-hidden"},{default:n(()=>[e(R,{title:m(p)("Previous Orders"),title_size:"small"},null,8,["title"]),e(B,{class:"px-0 pb-0"},{default:n(()=>[l("div",ns,[e(V,{data:t.prevOrders,class:"w-full"},{default:n(()=>[e(D,{width:120,label:m(p)("ID")},{default:n(d=>[e(i,{class:"link",to:{name:"view_order",params:{order_id:d.row.id}}},{default:n(()=>[x(" #"+c(d.row.id),1)]),_:2},1032,["to"])]),_:1},8,["label"]),e(D,{width:120,label:m(p)("Amount")},{default:n(d=>[l("span",null,c(t.formatNumber(d.row.total_paid)),1)]),_:1},8,["label"]),e(D,{width:150,label:m(p)("Date"),prop:"created_at"},{default:n(d=>[l("span",null,c(m(Q)(d.row.created_at)),1)]),_:1},8,["label"]),e(D,{label:m(p)("Status")},{default:n(d=>[e(W,{type:d.row.payment_status},{default:n(()=>[x(c(d.row.payment_status),1)]),_:2},1032,["type"]),e(W,{style:{"margin-left":"5px","margin-right":"5px"},type:d.row.type},{default:n(()=>[x(c(d.row.type),1)]),_:2},1032,["type"]),e(ie,{order:d.row},null,8,["order"])]),_:1},8,["label"])]),_:1},8,["data"])])]),_:1})]),_:1})):L("",!0),e(F,{class:"overflow-hidden"},{default:n(()=>[e(R,{title:m(p)("Activated Sites"),title_size:"small",border_bottom:""},null,8,["title"]),e(B,null,{default:n(()=>[e($l,{modelValue:t.site_url,"onUpdate:modelValue":s[0]||(s[0]=d=>t.site_url=d),onSiteActivated:t.activateSite,onSiteDeactivated:t.deactivateSite,activatedSites:t.activatedSites,activationLimit:t.limit,activationCount:t.activations.length},null,8,["modelValue","onSiteActivated","onSiteDeactivated","activatedSites","activationLimit","activationCount"])]),_:1})]),_:1}),t.logs.length>0?(o(),$(F,{key:1},{default:n(()=>[e(B,null,{default:n(()=>[l("div",as,[e(P,{style:{"padding-left":"2px"}},{default:n(()=>[(o(!0),h(T,null,H(t.logs,d=>{var w;return o(),$(y,{key:d,timestamp:m(Z)((w=t.license)==null?void 0:w.updated_at).format("MMMM DD, YYYY"),placement:"top",color:"blue"},{default:n(()=>[l("div",{innerHTML:d.meta_value},null,8,ls)]),_:2},1032,["timestamp"])}),128))]),_:1})])]),_:1})]),_:1})):L("",!0)])]),_:1}),e(v,{lg:7},{default:n(()=>[l("div",ss,[e(Ke,{order:t.order,shouldEnableEditing:!0,onOnAddressSelected:s[1]||(s[1]=d=>{d.type==="shipping"?t.order.shipping_address_id=d.id:t.order.billing_address_id=d.id})},null,8,["order"]),e(F,null,{default:n(()=>[e(R,{title:m(p)("Actions"),title_size:"small",border_bottom:""},null,8,["title"]),e(B,null,{default:n(()=>[l("div",is,[l("ul",os,[l("li",rs,[t.license.status!=="disabled"?(o(),$(f,{key:0,width:"210","confirm-button-text":m(p)("Confirm"),"cancel-button-text":m(p)("No, Thanks"),title:m(p)("Are you sure?"),onConfirm:s[2]||(s[2]=d=>t.updateLicenseStatus("disabled"))},{reference:n(()=>[e(I,{text:"",class:"!text-red-500 !mt-0"},{default:n(()=>[x(c(m(p)("Disable")),1)]),_:1})]),_:1},8,["confirm-button-text","cancel-button-text","title"])):L("",!0),t.license.status==="disabled"?(o(),$(f,{key:1,width:"210","confirm-button-text":m(p)("Confirm"),"cancel-button-text":m(p)("No, Thanks"),title:m(p)("Are you sure?"),onConfirm:s[3]||(s[3]=d=>t.updateLicenseStatus("active"))},{reference:n(()=>[e(I,{text:"",class:"!text-primary-500 !mt-0"},{default:n(()=>[x(c(m(p)("Enable")),1)]),_:1})]),_:1},8,["confirm-button-text","cancel-button-text","title"])):L("",!0)])])])]),_:1})]),_:1}),t.loading?L("",!0):(o(),$(We,{key:0,"bind-to-id":t.license.id,"bind-to-type":"FluentCartPro\\App\\Modules\\Licensing\\Models\\License",selectedLabels:t.selectedLabels,shouldEnableEditing:!0,"onUpdate:updateLabel":()=>{}},null,8,["bind-to-id","selectedLabels"]))])]),_:1})]),_:1})])],64)):L("",!0)],64))])):L("",!0)])}}}),us={class:"heading-wrap"},_s={class:"title"},ms={key:0,class:"heading-action"},ps={__name:"Heading",props:{title:String},setup(a){const t=Ae();return(s,k)=>(o(),h("div",us,[l("h2",_s,c(a.title),1),m(t).actions?(o(),h("div",ms,[Pe(s.$slots,"actions")])):L("",!0)]))}},hs={name:"AllLicenses",components:{Pagination:Re,Heading:ps},data(){return{licenses:[],paginate:{per_page:10,current_page:1,total:0,last_page:1},loading:!1,is_loaded:!1,search:""}},methods:{fetch(){this.loading=!0,this.$get("licensing/licenses/customer/1",{page:this.paginate.current_page,per_page:this.paginate.per_page,search:this.search}).then(a=>{this.licenses=a.licenses.data,this.paginate.total=a.licenses.total,this.paginate.last_page=a.licenses.last_page}).catch(a=>{this.handleError(a)}).finally(()=>{this.loading=!1,this.is_loaded=!0})},getProductName(a){return a?(a==null?void 0:a.product.post_title)+" - "+a.variation_label:"n/a"},onCurrentPageChanged({page:a,currentPageCount:t}){this.paginate.current_page=a,this.fetch()},onPerPageChanged(a){this.paginate.per_page=a,this.fetch()}},mounted(){this.fetch()}},fs={class:"all_licenses"},gs={class:"bg-white dark:bg-dark-700"},vs={key:0},bs={key:1},ys={class:"py-2.5 px-7.5 dark:bg-gray-800"},ws={class:"flex justify-between"},ks={class:"flex items-center gap-2"};function Ls(a,t,s,k,r,i){const S=u("Heading"),C=u("router-link"),b=u("el-table-column"),D=u("el-table"),V=u("pagination");return o(),h("div",fs,[e(S,{title:"All Licenses"}),l("div",gs,[e(D,{stripe:"",data:r.licenses},{default:n(()=>[e(b,{label:"ID",width:100},{default:n(y=>[e(C,{to:{name:"view_license",params:{license_id:y.row.id}}},{default:n(()=>[x(" #"+c(y.row.id),1)]),_:2},1032,["to"])]),_:1}),e(b,{width:290,label:"License Key"},{default:n(y=>[e(C,{to:{name:"view_license",params:{license_id:y.row.id}}},{default:n(()=>[x(c(y.row.license_key),1)]),_:2},1032,["to"])]),_:1}),e(b,{width:100,label:"Status"},{default:n(y=>[l("span",null,c(y.row.status),1)]),_:1}),e(b,{"min-width":300,label:"Product"},{default:n(y=>[x(c(i.getProductName(y.row.product_details)),1)]),_:1}),e(b,{"min-width":120,label:"Customer"},{default:n(y=>[e(C,{to:{name:"view_customer",params:{customer_id:y.row.customer_id}}},{default:n(()=>{var P;return[x(c(((P=y.row)==null?void 0:P.customer.full_name)||"No Customer Found"),1)]}),_:2},1032,["to"])]),_:1}),e(b,{width:120,label:"Activations"},{default:n(y=>[x(c(y.row.activation_count)+" / "+c(y.row.limit||"Unlimited"),1)]),_:1}),e(b,{width:160,label:"Expires"},{default:n(y=>[y.row.expiration_date?(o(),h("span",vs,c(y.row.expiration_date),1)):(o(),h("span",bs,"Lifetime"))]),_:1}),e(b,{width:160,label:"Purchased"},{default:n(y=>[e(C,{to:{name:"view_order",params:{order_id:y.row.order_id}}},{default:n(()=>[x(c(y.row.created_at),1)]),_:2},1032,["to"])]),_:1})]),_:1},8,["data"]),l("div",ys,[l("div",ws,[l("div",ks,[e(V,{"pager-only":!0,hide_on_single:!1,pagination:r.paginate,onFetch:i.fetch,onCurrentPageChanged:i.onCurrentPageChanged,onOnPerPageChanged:i.onPerPageChanged},null,8,["pagination","onFetch","onCurrentPageChanged","onOnPerPageChanged"])]),e(V,{hide_on_single:!1,pagination:r.paginate,onFetch:i.fetch,onCurrentPageChanged:i.onCurrentPageChanged,onOnPerPageChanged:i.onPerPageChanged},null,8,["pagination","onFetch","onCurrentPageChanged","onOnPerPageChanged"])])])])])}const Cs=G(hs,[["render",Ls]]);window.fluent_cart_admin.hooks.addFilter("fluent_cart_routes","fluent_all_licenses",function(a){return a.product_route.children.push({name:"license_settings",path:"license_settings",props:!0,component:Dt,meta:{active_menu:"products",title:"License Settings",permission:"store/sensitive"}}),a.license_route={name:"licenses",path:"/licenses",component:da,meta:{active_menu:"licenses",title:"Licenses",permission:"store/sensitive"}},a.view_license={name:"view_license",path:"/licenses/:license_id/view",component:ds,props:!0,meta:{active_menu:"licenses",title:"View License",permission:"store/sensitive"}},a.view_customer_licenses={name:"view_customer_licenses",path:"/licenses/customer/:customer_id",component:Cs,props:!0,meta:{active_menu:"licenses",title:"View License",permission:"store/sensitive"}},a});
