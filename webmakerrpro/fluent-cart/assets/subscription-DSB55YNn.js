import{a as c,c as f,o as d,d as e,b as _,w as n,u as h,e as b,f as s,F as E,h as W,x as te,i as se,j as ie,k as ne,a0 as O,g as T,t as p}from"./vue.esm-bundler-VLZRLwDo.js";import{T as oe,P as le,a as ae,C as y,c as w,d as C}from"./RouteCell-BYUiwRDq.js";import{t as u}from"./Translator-B6cROAk_.js";import{A as F}from"./Arr-MwYQQ3qa.js";import{d as re,S as ce,_ as X,e as de,b as ue,c as pe,a as _e}from"./CancelSubscription-D5qO-o_8.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{d as L,r as be,E as D,b as me}from"./index-BSdFqZUc.js";import{a as Y}from"./CopyToClipboard-O88DxGEb.js";import{_ as fe}from"./Empty-BDIgPk4r.js";import{e as he,L as ge,d as ve,f as ye}from"./OrderCustomerInformation-BSviIcPQ.js";import{S as Z}from"./Str-DQr93RbR.js";import{_ as ee}from"./DynamicIcon-B1vpMEi_.js";import{_ as we}from"./NotFound-C0jL-sdJ.js";import{B as Ce}from"./Badge-DsywDH_m.js";import{g as Se}from"./common-BPfjXdxy.js";import{n as Q}from"./Notify-DKZN7muO.js";import"./Model-D7MrDQPf.js";import"./Rest-U7WPPDzn.js";import"./Url-DcFY6RBb.js";import"./dayjs.min-2rai63wT.js";import"./timezone-C2U15obx.js";import"./Utils-rKpXNRVE.js";import"./productService-CeLFdK8B.js";import"./Asset-CBhXzPc7.js";const $e={class:"fc-subscriptions-route-wrap"},ke=Object.assign({name:"SubscriptionsRoute"},{__name:"SubscriptionsRoute",setup(t){return(i,l)=>{const a=c("router-view");return d(),f("div",$e,[e(a)])}}});class Te extends oe{getTabs(){return{all:u("All"),active:u("Active"),trialing:u("Trialing"),pending:u("Pending"),intended:u("Intended"),expired:u("Expired"),canceled:u("Canceled")}}getToggleableColumns(){return[{label:u("Order ID"),value:"order_id"},{label:u("Next Billing Date"),value:"next_billing_date"},{label:u("Collection Method"),value:"collection_method"},{label:u("Bills Count"),value:"bills_count"},{label:u("Customer"),value:"customer"},{label:u("Payment Method"),value:"payment_method"}]}getSortableColumns(){return[{label:u("Subscription ID"),value:"id"},{label:u("Next Billing Date"),value:"next_billing_date"},{label:u("Bills Count"),value:"bill_count"},{label:u("Created At"),value:"created_at"},{label:u("Status"),value:"status"}]}getSearchHint(){return u("by id, order id, status, payment method, customer name, or product.")}getFetchUrl(){return"subscriptions"}parseResponse(i){return i.data}getTableName(){return"subscriptions"}getAdvanceFilterOptions(){return F.get(window,"fluentCartAdminApp.filter_options.subscription_filter_options.advance")}getSearchGuideOptions(){return F.get(window,"fluentCartAdminApp.filter_options.subscription_filter_options.guide")}with(){return["customer"]}}function Be(t){return Te.init(t)}const xe={class:"table-cell"},Le={class:"table-cell"},Oe={class:"table-cell"},Fe={class:"table-cell"},Pe={class:"table-cell"},Me={class:"table-cell"},Ie={class:"table-cell"},Re={class:"table-cell"},De={class:"table-cell"},Ee={class:"table-cell"},Ae={class:"table-cell"},Ve={class:"table-cell"},Ne={__name:"SubscriptionsLoader",props:{nextPageCount:{type:Number,default:0},subscriptionTable:{type:Object,default:()=>({})}},setup(t){const i=t,l=Array.from({length:i.nextPageCount},(a,o)=>o+1);return(a,o)=>{const r=c("el-table-column"),m=c("el-skeleton-item"),S=c("el-table"),v=c("el-skeleton");return d(),_(v,{animated:""},{template:n(()=>[e(S,{data:h(l),class:"w-full compact-table responsive"},{empty:n(()=>o[0]||(o[0]=[])),default:n(()=>[b("",!0),e(r,{label:a.$t("ID"),width:"100"},{default:n(()=>[s("div",xe,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"]),e(r,{label:a.$t("Customer"),width:"280"},{default:n(()=>[s("div",Le,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"]),e(r,{label:a.$t("Product"),width:"360","show-overflow-tooltip":""},{default:n(()=>[s("div",Oe,[e(m,{varient:"p",class:"w-3/5"})])]),_:1},8,["label"]),e(r,{label:a.$t("Status"),width:"120"},{default:n(()=>[s("div",Fe,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"]),e(r,{label:a.$t("Billing"),width:"230"},{default:n(()=>[s("div",Pe,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"]),e(r,{label:a.$t("Created At"),width:"130"},{default:n(()=>[s("div",Me,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"]),t.subscriptionTable.data.columns.indexOf("valid_till")!==-1?(d(),_(r,{key:1,label:a.$t("Valid Till"),width:"120"},{default:n(()=>[s("div",Ie,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])):b("",!0),t.subscriptionTable.data.columns.indexOf("next_billing_date")!==-1?(d(),_(r,{key:2,label:a.$t("Next Billing Date"),width:"160"},{default:n(()=>[s("div",Re,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])):b("",!0),t.subscriptionTable.data.columns.indexOf("collection_method")!==-1?(d(),_(r,{key:3,label:a.$t("Collection Method"),width:"160"},{default:n(()=>[s("div",De,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])):b("",!0),t.subscriptionTable.data.columns.indexOf("bills_count")!==-1?(d(),_(r,{key:4,label:a.$t("Bills Count"),width:"100"},{default:n(()=>[s("div",Ee,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])):b("",!0),t.subscriptionTable.data.columns.indexOf("payment_method")!==-1?(d(),_(r,{key:5,label:a.$t("Payment Method"),width:"150"},{default:n(()=>[s("div",Ae,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])):b("",!0),t.subscriptionTable.data.columns.indexOf("order_id")!==-1?(d(),_(r,{key:6,label:a.$t("Order ID"),width:"100"},{default:n(()=>[s("div",Ve,[e(m,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])):b("",!0)]),_:1},8,["data"])]),_:1})}}},je={},ze={class:"px-4 py-3"},He={class:"grid grid-cols-3 gap-5 mt-5"};function We(t,i){const l=c("el-skeleton-item"),a=c("el-skeleton");return d(),_(a,{animated:""},{template:n(()=>[s("div",ze,[(d(),f(E,null,W(2,o=>s("div",{key:o,class:"flex items-center justify-between mb-3"},[e(l,{varient:"p",class:"w-1/2"}),e(l,{varient:"p",class:"w-[100px]"})])),64)),s("div",He,[(d(),f(E,null,W(3,o=>s("div",{key:o},[e(l,{varient:"p",class:"w-1/2"}),e(l,{varient:"p",class:"w-[100px]"})])),64))])])]),_:1})}const Ue=U(je,[["render",We]]),qe={class:"fc-all-subscriptions-page fc-layout-width"},Ge={class:"fc-all-subscriptions-wrap"},Je={key:1},Ke={__name:"AllSubscriptions",setup(t){const i=Be({instance:te()}),l=se(!1),a=()=>{l.value=window.innerWidth<768};return ie(()=>{a(),window.addEventListener("resize",a)}),ne(()=>{window.removeEventListener("resize",a)}),(o,r)=>(d(),f("div",qe,[e(le,{title:o.$t("Subscriptions")},null,8,["title"]),s("div",Ge,[e(ae,{table:h(i),classicTabStyle:!0,"has-mobile-slot":!0},{mobile:n(()=>[h(i).isLoading()?(d(),_(Ue,{key:0})):b("",!0),h(i).isLoading()?b("",!0):(d(),_(ce,{key:1,subscriptions:h(i).getTableData(),columns:h(i).data.columns},null,8,["subscriptions","columns"]))]),default:n(()=>[h(i).isLoading()?(d(),_(Ne,{key:0,subscriptionTable:h(i),"next-page-count":h(i).nextPageCount},null,8,["subscriptionTable","next-page-count"])):(d(),f("div",Je,[e(re,{subscriptions:h(i).getTableData(),columns:h(i).data.columns},null,8,["subscriptions","columns"])]))]),_:1},8,["table"])])]))}},Qe={name:"SubscriptionDetails",props:["subscription","orderId"],emits:["reload","fetchOrder"],data(){return{loadingState:{fetch:!1,pause:!1,resume:!1,cancel:!1},cancelSubscriptionModal:!1}},components:{CancelSubscription:de,ConvertedTime:X,CopyToClipboard:Y,CardContainer:C,CardBody:w,CardHeader:y,DynamicIcon:ee,Refresh:be,Delete:L},computed:{Str(){return Z},permissions(){var l,a;const t=(((l=this.subscription)==null?void 0:l.status)||"").toLowerCase();let i=(a=this.subscription)==null?void 0:a.vendor_subscription_id;return{canFetch:!0,canPause:i&&!["canceled","paused","trialing","pending","intended","active(collection paused)"].includes(t),canResume:i&&["paused","active(collection paused)"].includes(t),canCancel:i&&!["canceled"].includes(t)}},paymentMethod(){var t;return((t=this.subscription)==null?void 0:t.current_payment_method)||""}},methods:{handleSubscriptionAction(t){t==="fetch_subscription"?this.confirmFetch():t==="pause_subscription"?this.confirmPause():t==="resume_subscription"?this.confirmResume():t==="cancel_subscription"&&this.confirmCancel()},confirmFetch(){var t;!this.subscription.vendor_subscription_id&&((t=this.order)==null?void 0:t.payment_method)!=="offline_payment"||D.confirm("Fetch from remote and update the subscription?","Warning",{type:"warning",icon:O(L),cancelButtonText:"Back",confirmButtonText:"Fetch subscription!",beforeClose:async(i,l,a)=>{var o,r;if(i==="confirm")try{l.confirmButtonLoading=!0,this.loadingState.fetch=!0,await this.$put(`orders/${this.orderId}/subscriptions/${this.subscription.id}/fetch`,{data:{vendor_charge_id:this.subscription.vendor_subscription_id}}),this.$notify({type:"success",title:"Success",message:"Subscription fetched successfully"}),this.$emit("reload")}catch(m){this.$notify({type:"error",title:"Error",message:u(((r=(o=m.response)==null?void 0:o.data)==null?void 0:r.message)||"Failed to fetch subscription")}),console.error(m)}finally{l.confirmButtonLoading=!1,this.loadingState.fetch=!1,a()}else a()}})},confirmPause(){this.subscription.vendor_subscription_id&&D.prompt("Pause the active subscription?","Warning",{type:"warning",icon:O(L),inputPlaceholder:"Enter reason for pausing",inputPattern:/.+/,inputErrorMessage:"Reason is required",cancelButtonText:"Back",confirmButtonText:u("Pause Subscription!"),beforeClose:async(t,i,l)=>{var a,o;if(t==="confirm")try{i.confirmButtonLoading=!0,this.loadingState.pause=!0,await this.$put(`orders/${this.orderId}/subscriptions/${this.subscription.id}/pause`,{data:{vendor_subscription_id:this.subscription.vendor_subscription_id,reason:i.inputValue}}),this.$notify({type:"success",title:"Success",message:"Subscription paused successfully"}),this.$emit("reload")}catch(r){this.$notify({type:"error",title:"Error",message:u(((o=(a=r.response)==null?void 0:a.data)==null?void 0:o.message)||"Failed to pause subscription")}),console.error(r)}finally{i.confirmButtonLoading=!1,this.loadingState.pause=!1,l()}else l()}})},confirmResume(){this.subscription.vendor_subscription_id&&D.prompt(u("Resume the paused subscription?"),u("Warning"),{type:"warning",icon:O(L),inputPlaceholder:u("Enter reason for resuming"),inputPattern:/.+/,inputErrorMessage:u("Reason is required"),cancelButtonText:u("Back"),confirmButtonText:u("Resume Subscription!"),beforeClose:async(t,i,l)=>{if(t==="confirm")try{i.confirmButtonLoading=!0,this.loadingState.resume=!0,await this.$put(`orders/${this.orderId}/subscriptions/${this.subscription.id}/resume`,{data:{vendor_subscription_id:this.subscription.vendor_subscription_id,reason:i.inputValue}}),this.$notify({type:"success",title:"Success",message:"Subscription resumed successfully"}),this.$emit("reload")}catch(a){this.$notify({type:"error",title:"Error",message:"Failed to resume subscription"}),console.error(a)}finally{i.confirmButtonLoading=!1,this.loadingState.resume=!1,l()}else l()}})},confirmCancel(){this.subscription.vendor_subscription_id&&(this.cancelSubscriptionModal=!0)},confirmReactivate(){this.subscription.vendor_subscription_id&&D.confirm("Reactivate the canceled subscription?","Warning",{type:"warning",icon:O(L),cancelButtonText:"Back",confirmButtonText:"Reactivate Subscription!",beforeClose:async(t,i,l)=>{var a,o;if(t==="confirm")try{i.confirmButtonLoading=!0,this.loadingState.reactivate=!0,await this.$put(`orders/${this.orderId}/subscriptions/${this.subscription.id}/reactivate`,{data:{vendor_subscription_id:this.subscription.vendor_subscription_id}}),this.$notify({type:"success",title:"Success",message:"Subscription reactivated successfully"}),this.$emit("reload")}catch(r){this.$notify({type:"error",title:"Error",message:u(((o=(a=r.response)==null?void 0:a.data)==null?void 0:o.message)||"Failed to reactivate subscription")}),console.error(r)}finally{i.confirmButtonLoading=!1,this.loadingState.reactivate=!1,l()}else l()}})}}},Xe={class:"more-btn"},Ye={class:"text-red-600"},Ze={class:"fc-single-subscription-pricing-table"},et={class:"fc-single-subscription-details"},tt={class:"fc-single-subscription-details-label"},st=["innerHTML"],it={class:"fc-single-subscription-details-label"},nt={class:"fc-single-subscription-details-value"},ot={key:0},lt={key:1,class:"flex items-center gap-2.5"},at={class:"fc-single-subscription-details-label"},rt={class:"fc-single-subscription-details-value"},ct={class:"fc-single-subscription-details-label"},dt={class:"fc-single-subscription-details-value"},ut={class:"fc-single-subscription-details-label"},pt={class:"fc-single-subscription-details-value"},_t={class:"fc-single-subscription-details-label"},bt={class:"fc-single-subscription-details-value"},mt={class:"fc-single-subscription-details-label"},ft={class:"fc-single-subscription-details-value"},ht={key:0,class:"flex items-center justify-between gap-2 w-full"},gt={class:"truncate w-[calc(100%-2rem)] overflow-hidden text-ellipsis whitespace-nowrap block"},vt={key:1,class:"text-system-light dark:text-gray-300"},yt={key:0},wt={class:"fc-single-subscription-details-label"},Ct=["href"],St={class:"fc-single-subscription-details-label"},$t={class:"fc-single-subscription-details-value"},kt={key:0,class:"flex items-center justify-between"},Tt={class:"truncate w-[calc(100%-2rem)] overflow-hidden text-ellipsis whitespace-nowrap block"},Bt={key:1,class:"text-system-light dark:text-gray-300"};function xt(t,i,l,a,o,r){const m=c("DynamicIcon"),S=c("refresh"),v=c("el-icon"),$=c("el-dropdown-item"),A=c("delete"),V=c("el-dropdown-menu"),N=c("el-dropdown"),B=c("CardHeader"),P=c("ConvertedTime"),M=c("el-tooltip"),k=c("CopyToClipboard"),j=c("CardBody"),z=c("CancelSubscription"),H=c("CardContainer");return d(),_(H,null,{default:n(()=>[e(B,{border_bottom:"",title:t.$t("Subscription Details"),title_size:"small"},{default:n(()=>[l.subscription.vendor_subscription_id&&(r.permissions.canFetch||r.permissions.canPause||r.permissions.canResume||r.permissions.canCancel)?(d(),_(N,{key:0,trigger:"click",class:"fc-more-option-wrap","popper-class":"fc-dropdown",onCommand:i[0]||(i[0]=g=>r.handleSubscriptionAction(g))},{dropdown:n(()=>[e(V,null,{default:n(()=>[r.permissions.canFetch?(d(),_($,{key:0,command:"fetch_subscription"},{default:n(()=>[e(v,null,{default:n(()=>[e(S)]),_:1}),T(" "+p(t.$t("Fetch subscription -"))+" "+p(r.paymentMethod),1)]),_:1})):b("",!0),r.permissions.canPause?(d(),_($,{key:1,command:"pause_subscription"},{default:n(()=>[e(v,null,{default:n(()=>[e(S)]),_:1}),T(" "+p(t.$t("Pause subscription -"))+" "+p(r.paymentMethod),1)]),_:1})):b("",!0),r.permissions.canResume?(d(),_($,{key:2,command:"resume_subscription"},{default:n(()=>[e(v,null,{default:n(()=>[e(S)]),_:1}),T(" "+p(t.$t("Resume subscription -"))+" "+p(r.paymentMethod),1)]),_:1})):b("",!0),r.permissions.canCancel?(d(),_($,{key:3,command:"cancel_subscription"},{default:n(()=>[e(v,null,{default:n(()=>[e(A)]),_:1}),s("span",Ye,p(t.$t("Cancel subscription")),1)]),_:1})):b("",!0)]),_:1})]),default:n(()=>[s("span",Xe,[e(m,{name:"More"})])]),_:1})):b("",!0)]),_:1},8,["title"]),e(j,null,{default:n(()=>{var g,I,x,R,q,G,J;return[s("div",Ze,[s("p",null,p(t.$t("Product Name")),1),s("h3",null,p(l.subscription.item_name),1)]),s("ul",et,[s("li",null,[s("div",tt,p(t.$t("Billing Cycle")),1),s("div",{class:"fc-single-subscription-details-value",innerHTML:l.subscription.payment_info},null,8,st)]),s("li",null,[s("div",it,p(t.$t("Active Payment Gateway")),1),s("div",nt,[l.subscription.current_payment_method?(d(),f("div",lt,[s("span",null,p(r.Str.headline(l.subscription.current_payment_method)),1)])):(d(),f("span",ot,"----"))])]),s("li",null,[s("div",at,p(t.$t("Initial Purchase ID")),1),s("div",rt," #"+p(l.subscription.parent_order_id),1)]),s("li",null,[s("div",ct,p(t.$t("Auto-cancellation")),1),s("div",dt,p(l.subscription.expire_at?l.subscription.expire_at:"---"),1)]),s("li",null,[s("div",ut,p(t.$t("Started")),1),s("div",pt,[e(P,{"date-time":l.subscription.created_at,withTime:!1},null,8,["date-time"])])]),s("li",null,[s("div",_t,p(t.$t("Next invoice")),1),s("div",bt,[T(p(t.formatNumber(l.subscription.recurring_total))+" on ",1),e(P,{"date-time":l.subscription.next_billing_date,withTime:!1},null,8,["date-time"])])]),s("li",null,[s("div",mt,p(t.$t("Vendor Subscription ID")),1),s("div",ft,[l.subscription.vendor_subscription_id?(d(),f("div",ht,[e(M,{class:"w-full",content:l.subscription.vendor_subscription_id,placement:"top","popper-class":"fc-tooltip"},{default:n(()=>[s("span",gt,p(l.subscription.vendor_subscription_id),1)]),_:1},8,["content"]),e(k,{text:l.subscription.vendor_subscription_id,showMode:"basic_copy_btn",tooltipText:"Copy"},null,8,["text"])])):(d(),f("span",vt,p(t.$t("n/a")),1))])]),(g=l.subscription)!=null&&g.vendor_subscription_id?(d(),f("li",yt,[s("div",wt," View on "+p((I=l.subscription)==null?void 0:I.current_payment_method)+": ",1),s("a",{target:"_blank",class:"fc-single-subscription-details-value !underline focus:shadow-none",href:(x=l.subscription)==null?void 0:x.url},p((R=l.subscription)==null?void 0:R.vendor_subscription_id),9,Ct)])):b("",!0),s("li",null,[s("div",St,p(t.$t("Vendor Customer ID")),1),s("div",$t,[(q=l.subscription)!=null&&q.vendor_customer_id?(d(),f("div",kt,[e(M,{class:"w-full",content:(G=l.subscription)==null?void 0:G.vendor_customer_id,placement:"top","popper-class":"fc-tooltip"},{default:n(()=>{var K;return[s("span",Tt,p((K=l.subscription)==null?void 0:K.vendor_customer_id),1)]}),_:1},8,["content"]),e(k,{text:(J=l.subscription)==null?void 0:J.vendor_customer_id,showMode:"basic_copy_btn",tooltipText:"Copy"},null,8,["text"])])):(d(),f("span",Bt,p(t.$t("n/a")),1))])])])]}),_:1}),e(z,{subscription:l.subscription,orderId:l.orderId,onClose:i[1]||(i[1]=g=>o.cancelSubscriptionModal=!1),modelValue:o.cancelSubscriptionModal,"onUpdate:modelValue":i[2]||(i[2]=g=>o.cancelSubscriptionModal=g),onReload:i[3]||(i[3]=g=>t.$emit("reload")),onCancelSubscription:r.confirmCancel},null,8,["subscription","orderId","modelValue","onCancelSubscription"])]),_:1})}const Lt=U(Qe,[["render",xt]]),Ot={class:"fc-single-order-loader-wrap fc-layout-width"},Ft={class:"single-page-header fc-page-loader-header min-h-18 flex items-start justify-between"},Pt={class:"single-page-body"},Mt={class:"fc-single-order"},It={class:"fc-single-order-main"},Rt={class:"fc-single-order-aside"},Dt={class:"fc-admin-sidebar"},Et={props:{loading:{type:Boolean,default:!1}}},At=Object.assign(Et,{__name:"SingleSubscriptionLoader",setup(t){return(i,l)=>{const a=c("el-skeleton-item"),o=c("el-skeleton");return d(),f("div",Ot,[s("div",Ft,[e(o,{animated:"",class:"flex flex-col items-start gap-2"},{template:n(()=>[e(a,{class:"max-w-180"}),e(a,{class:"max-w-[100px]"})]),_:1})]),s("div",Pt,[s("div",Mt,[s("div",It,[e(C,{class:"overflow-hidden"},{default:n(()=>[e(y,{border_bottom:"",title:i.$t("Subscription Details")},null,8,["title"]),e(w,{class:"grid gap-5 grid-cols-[repeat(auto-fit,minmax(200px,1fr))]"},{default:n(()=>[(d(),f(E,null,W(9,r=>e(o,{key:r,animated:!0},{template:n(()=>[s("div",null,[e(a,{variant:"p",class:"w-full"}),e(a,{variant:"p",style:{width:"50%"}})])]),_:2},1024)),64))]),_:1})]),_:1}),e(C,{class:"overflow-hidden"},{default:n(()=>[e(y,{border_bottom:"",title:i.$t("Related Orders")},null,8,["title"]),e(w,null,{default:n(()=>[e(o,{animated:"",rows:3})]),_:1})]),_:1}),e(C,{class:"overflow-hidden"},{default:n(()=>[e(y,{border_bottom:"",title:i.$t("Related Licenses")},null,8,["title"]),e(w,null,{default:n(()=>[e(o,{animated:"",rows:3})]),_:1})]),_:1})]),s("div",Rt,[s("div",Dt,[e(C,null,{default:n(()=>[e(y,{title:i.$t("Subscription Plan"),border_bottom:"",title_size:"small"},null,8,["title"]),e(w,null,{default:n(()=>[e(o,{animated:"",rows:2})]),_:1})]),_:1}),e(C,null,{default:n(()=>[e(y,{title:i.$t("Customer Details"),border_bottom:"",title_size:"small"},null,8,["title"]),e(w,null,{default:n(()=>[e(o,{animated:"",rows:3})]),_:1})]),_:1}),e(C,null,{default:n(()=>[e(y,{title:i.$t("Labels"),border_bottom:"",title_size:"small"},null,8,["title"]),e(w,null,{default:n(()=>[e(o,{animated:"",rows:1})]),_:1})]),_:1})])])])])])}}}),Vt={name:"SingleSubscription",props:["subscription_id"],data(){return{notFound:{show:!1,message:"",buttonText:"",route:""},subscription:{},loading:!1,parentOrderLoading:!0,error:null,ArrowRight:O(me),parentOrder:null,selectedLabels:[],changeCustomer:!1}},watch:{subscription_id:{handler(t,i){this.fetchSubscription()}}},computed:{Str(){return Z},subscriptionStatus(){var t;return(t=this.subscription)==null?void 0:t.status}},components:{ChangeOrderCustomer:ye,DynamicIcon:ee,ConvertedTime:X,Badge:Ce,NotFound:we,SingleSubscriptionLoader:At,SubscriptionDetails:Lt,Labels:ve,LicenseTable:ge,Empty:fe,CopyToClipboard:Y,CardContainer:C,CardBody:w,CardHeader:y,OrdersTable:_e,CustomerPurchaseValue:pe,OrderCustomerInformation:he,OrdersTableMobile:ue},methods:{translate:u,getCardBrand:Se,fetchSubscription(){this.notFound.show=!1,this.loading=!0,this.$get("subscriptions/"+this.subscription_id).then(t=>{this.subscription=t.subscription,this.selectedLabels=t.selected_labels,this.getParentOrder()}).catch(t=>{t.code==="fluent_cart_entity_not_found"?(this.notFound.show=!0,this.notFound.buttonText=F.get(t,"data.buttonText"),this.notFound.message=F.get(t,"data.message"),this.notFound.route=F.get(t,"data.route")):t.status_code=="422"?Q.validationErrors(t):Q.error(t.message)}).finally(()=>{this.loading=!1})},getParentOrder(){var t;this.$get("orders/"+((t=this.subscription)==null?void 0:t.parent_order_id)).then(i=>{this.parentOrder=i.order}).finally(()=>{this.parentOrderLoading=!1})},reload(){window.location.reload()},handleCommand(t){t==="change_customer"&&(this.changeCustomer=!0)}},mounted(){this.fetchSubscription()}},Nt={key:1,class:"fc-single-subscription-page"},jt={key:1,class:"fc-single-order-wrapper fc-layout-width"},zt={class:"single-page-header flex items-start justify-between"},Ht={class:"single-page-header-title-wrap"},Wt={class:"single-page-header-status-wrap"},Ut={class:"pt-2 text-xs text-system-mid dark:text-gray-300"},qt={class:"single-page-body"},Gt={class:"fc-single-subscription"},Jt={class:"fc-single-subscription-main"},Kt={class:"fc-single-subscription-aside"},Qt={class:"fc-admin-sidebar"},Xt={class:"fc-admin-sidebar"};function Yt(t,i,l,a,o,r){var x;const m=c("NotFound"),S=c("SingleSubscriptionLoader"),v=c("el-breadcrumb-item"),$=c("el-breadcrumb"),A=c("Badge"),V=c("ConvertedTime"),N=c("SubscriptionDetails"),B=c("CardHeader"),P=c("orders-table"),M=c("OrdersTableMobile"),k=c("CardContainer"),j=c("license-table"),z=c("el-skeleton"),H=c("CardBody"),g=c("OrderCustomerInformation"),I=c("Labels");return d(),f(E,null,[o.notFound.show?(d(),_(m,{key:0,"button-text":o.notFound.buttonText,message:o.notFound.message,route:o.notFound.route},null,8,["button-text","message","route"])):b("",!0),o.notFound.show===!1?(d(),f("div",Nt,[o.loading?(d(),_(S,{key:0})):b("",!0),!o.loading&&o.subscription.id?(d(),f("div",jt,[s("div",zt,[s("div",null,[s("div",Ht,[e($,{"separator-icon":o.ArrowRight},{default:n(()=>[e(v,{to:{name:"all_subscriptions"}},{default:n(()=>[T(p(t.$t("Subscriptions")),1)]),_:1}),e(v,null,{default:n(()=>[T("#"+p(l.subscription_id),1)]),_:1})]),_:1},8,["separator-icon"]),s("div",Wt,[e(A,{status:r.subscriptionStatus},null,8,["status"])])]),s("div",Ut,[e(V,{"date-time":o.subscription.created_at,"with-time":""},null,8,["date-time"])])]),i[2]||(i[2]=s("div",{class:"fc-btn-group sm"},null,-1))]),s("div",qt,[s("div",Gt,[s("div",Jt,[e(N,{subscription:o.subscription,orderId:(x=o.parentOrder)==null?void 0:x.id,onFetchOrder:i[0]||(i[0]=R=>t.$emit("fetchSubscription")),onReload:i[1]||(i[1]=R=>r.reload())},null,8,["subscription","orderId"]),e(k,{class:"overflow-hidden"},{default:n(()=>[e(B,{class:"pb-4",title:t.$t("Related Orders")+" ("+o.subscription.related_orders.length+")",title_size:"small"},null,8,["title"]),e(P,{class:"hide-on-mobile",orders:o.subscription.related_orders,columns:["type"]},null,8,["orders"]),e(M,{class:"show-on-mobile fc-single-subscription-orders-mobile",orders:o.subscription.related_orders,columns:["type"]},null,8,["orders"])]),_:1}),o.subscription.licenses?(d(),_(k,{key:0,class:"overflow-hidden"},{default:n(()=>[e(B,{class:"pb-4",title:t.$t("Related Licenses"),title_size:"small"},null,8,["title"]),e(j,{licenses:o.subscription.licenses,columns:[]},null,8,["licenses"])]),_:1})):b("",!0)]),s("div",Kt,[s("div",Qt,[o.parentOrderLoading?(d(),_(k,{key:0},{default:n(()=>[e(B,{title:t.$t("Subscription Plan"),title_size:"small",border_bottom:""},null,8,["title"]),e(H,null,{default:n(()=>[e(z,{rows:3,animated:!0})]),_:1})]),_:1})):b("",!0)]),s("div",Xt,[o.subscription.customer?(d(),_(g,{key:0,order:o.subscription,shouldEnableEditing:!0},null,8,["order"])):b("",!0),e(I,{"bind-to-id":o.subscription.id,"bind-to-type":"Subscription",selectedLabels:o.selectedLabels,shouldEnableEditing:!0,"onUpdate:updateLabel":()=>{}},null,8,["bind-to-id","selectedLabels"])])])])])])):b("",!0)])):b("",!0)],64)}const Zt=U(Vt,[["render",Yt]]);window.fluent_cart_admin.hooks.addFilter("fluent_cart_routes","fluent_all_subscriptions",function(t){return t.subscription_route={name:"subscriptions",path:"/subscriptions",component:ke,children:[{name:"all_subscriptions",path:"",component:Ke,meta:{active_menu:"subscriptions",title:"Subscriptions"}},{name:"view_subscription",path:":subscription_id/view",component:Zt,props:!0,meta:{active_menu:"subscriptions",title:u("View Subscription")}}]},t});
