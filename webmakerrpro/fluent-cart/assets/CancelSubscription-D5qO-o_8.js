import{c as d,o as s,t as n,u as r,d as o,w as l,f as e,e as v,g as C,F as D,a as f,i as V,b as w,A as G,h as j,z as J}from"./vue.esm-bundler-VLZRLwDo.js";import{_ as U}from"./Empty-BDIgPk4r.js";import{B,I as se}from"./Badge-DsywDH_m.js";import{t as i}from"./Translator-B6cROAk_.js";import{S as R}from"./Str-DQr93RbR.js";import{A as F}from"./Arr-MwYQQ3qa.js";import{U as X}from"./Url-DcFY6RBb.js";import{_ as L}from"./DynamicIcon-B1vpMEi_.js";import{_ as P}from"./RouteCell-BYUiwRDq.js";import{C as H}from"./productService-CeLFdK8B.js";import{O as Y}from"./OrderCustomerInformation-BSviIcPQ.js";import{R as oe}from"./Rest-U7WPPDzn.js";import{n as z}from"./Notify-DKZN7muO.js";import{L as ne}from"./NotFound-C0jL-sdJ.js";import{k as le,a as Z}from"./index-BSdFqZUc.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{f as K}from"./common-BPfjXdxy.js";const ae=["title"],Q={__name:"ConvertedTime",props:{dateTime:{type:[Object,String],required:!1},withTime:{type:Boolean,required:!1,default:!0},onlyTime:{type:Boolean,required:!1,default:!1}},setup(c){return(h,u)=>(s(),d("span",{title:r(K)(c.dateTime,c.withTime,null,null,!0)},n(r(K)(c.dateTime,c.withTime,null,null,c.onlyTime)),9,ae))}},re={class:"fc-popover-box"},ie={class:"fluent-cart-admin-pages"},ce={class:"fc-popover-content relative overflow-x-auto"},de={class:"fc-customer-info-list"},ue={class:"title"},_e={class:"dot-separator"},me={class:"text"},pe={class:"text"},fe={class:"fc-customer-card fc-popover-box-action"},he={class:"fc-customer-name mr-4 truncate"},ve={class:"fc-popover-box-action-icon"},W={__name:"CustomerInfoPopover",props:{customer:{type:Object,required:!0},toRoute:{type:Object,required:!0}},setup(c){return(h,u)=>{const g=f("router-link"),O=f("el-button"),a=f("el-popover");return s(),d("div",re,[o(a,{placement:"bottom-start",width:280,trigger:"click"},{reference:l(()=>{var m;return[e("div",fe,[e("div",he,n(((m=c.customer)==null?void 0:m.full_name)||r(i)("No Name")),1),e("div",ve,[o(L,{name:"ChevronDown"})])])]}),default:l(()=>{var m,y,k,I,p;return[e("div",ie,[e("div",ce,[e("ul",de,[e("li",null,[e("span",ue,n(((m=c.customer)==null?void 0:m.full_name)||r(i)("No Name")),1)]),e("li",null,[e("div",_e,[e("span",null,[c.customer.purchase_count>0?(s(),d(D,{key:0},[C(n(c.customer.purchase_count),1)],64)):v("",!0),C(" "+n(h.$n("Order","Orders",c.customer.purchase_count??0,"No Order")),1)]),e("span",null,n(c.customer.country_name),1)])]),u[0]||(u[0]=e("li",null,[e("div",{class:"separator"})],-1)),e("li",null,[e("div",me,[o(g,{to:{name:"view_customer",params:{customer_id:(y=c.customer)==null?void 0:y.id}}},{default:l(()=>{var T;return[C(n((T=c.customer)==null?void 0:T.email),1)]}),_:1},8,["to"])])]),e("li",null,[e("div",pe,n((I=(k=c.customer)==null?void 0:k.primary_billing_address)==null?void 0:I.phone),1)])]),o(O,{size:"small",class:"w-full mt-3.5",tag:"router-link",to:{name:"view_customer",params:{customer_id:(p=c.customer)==null?void 0:p.id}}},{default:l(()=>[C(n(h.$t("View Customer")),1)]),_:1},8,["to"])])])]}),_:1}),o(P,{class:"hover:no-underline",to:c.toRoute},{default:l(()=>u[1]||(u[1]=[e("span",null,"Â ",-1)])),_:1,__:[1]},8,["to"])])}}},be={class:"fc-bulk-delete-action-wrap p-4 pl-5 pt-0"},ye={class:"fc-bulk-delete-action-dialog-content space-y-4"},ge={key:0},we={class:"m-0 mb-2"},ke={key:0,class:"text-sm text-gray-600 mb-3"},$e={key:1},Ce={class:"m-0 mb-3"},xe={class:"max-h-60 overflow-x-hidden"},Oe={class:"font-mono text-sm"},Te={class:"flex items-center justify-end gap-2"},Se={class:"text-xs"},Ie={key:2,class:"!mt-2 p-3 bg-gray-50 dark:bg-primary-500 rounded"},Me={class:"flex justify-between text-sm"},Ne={class:"text-green-600"},Ae={class:"text-red-600"},De={key:3},Le={class:"text-sm text-red-600"},Ve={class:"flex justify-end"},Pe={__name:"BulkDeleteAction",props:{selectedOrders:{type:Array,required:!0},onComplete:{type:Function,default:()=>{}}},setup(c){const h=c,u=V(!1),g=V(0);V(!1);const O=V(!1),a=V([]),m=V(""),y=()=>{a.value=[],g.value=0,m.value=""},k=(t=0)=>{if(!h.selectedOrders.length){y();return}if(t>h.selectedOrders.length-1){setTimeout(()=>{const _=a.value.filter(E=>E.status==="success").length,A=a.value.filter(E=>E.status==="error").length;_>0&&z.success(`${_} orders deleted successfully`),A>0&&z.error(`${A} orders failed to delete`),u.value=!1,m.value=""},500);return}const b=h.selectedOrders[t],x=b.id,q=b.invoice_no;m.value=q;const N=a.value.findIndex(_=>_.id===x);if(b.status==="completed"){N!==-1&&(a.value[N].status="warning",a.value[N].error_message=`Cannot delete order ${q} due to status: completed`),g.value=Math.round((t+1)/h.selectedOrders.length*100),k(t+1);return}N!==-1&&(a.value[N].status="processing"),oe.delete("/orders/"+x,{ids:[x]}).then(_=>{N!==-1&&(a.value[N].status="success",a.value[N].invoice_no=_.data.invoice_no),g.value=Math.round((t+1)/h.selectedOrders.length*100),k(t+1)}).catch(_=>{console.log(`Error deleting order ${q} (ID: ${x}):`,_),N!==-1&&(a.value[N].status="error",a.value[N].error_message=_&&_.message||"Unknown error"),g.value=Math.round((t+1)/h.selectedOrders.length*100),k(t+1)})},I=()=>{h.selectedOrders.length&&(u.value=!0,O.value=!0,y(),a.value=h.selectedOrders.map(t=>({id:t.id,invoice_no:t.invoice_no,parent_id:t.parent_id,status:t.status==="completed"?"warning":"pending",error_message:t.status==="completed"?`Cannot delete order ${t.invoice_no} due to status: completed`:""})),k(0))},p=t=>{switch(t){case"success":return"Check";case"error":return"Cross";case"processing":return"Loading";case"warning":return"Warning";default:return"Clock"}},T=t=>{switch(t){case"success":return"text-green-500";case"error":return"text-red-500";case"processing":return"text-blue-500";case"warning":return"text-warning-500";default:return"text-gray-400"}},$=t=>{switch(t){case"success":return i("Success");case"error":return i("Failed");case"processing":return i("Processing...");case"warning":return i("Undeletable");default:return i("Pending")}},M=()=>{O.value=!1,h.onComplete()};return(t,b)=>{const x=f("el-button"),q=f("el-popconfirm"),N=f("el-progress"),_=f("el-table-column"),A=f("el-icon"),E=f("el-table"),te=f("el-dialog");return s(),d("div",be,[o(q,{title:r(i)("Are you sure you want to delete these orders?"),onConfirm:I,width:"250"},{reference:l(()=>[o(x,{type:"danger",size:"small",loading:u.value,disabled:u.value||!c.selectedOrders.length,class:"flex items-center gap-2"},{default:l(()=>[u.value?(s(),d(D,{key:1},[C(n(r(i)("Deleting...")),1)],64)):(s(),d(D,{key:0},[o(L,{name:"Delete",class:"w-4 h-4"}),C(" "+n(r(i)("Delete Selected (%s)",c.selectedOrders.length)),1)],64))]),_:1},8,["loading","disabled"])]),_:1},8,["title"]),o(te,{modelValue:O.value,"onUpdate:modelValue":b[1]||(b[1]=S=>O.value=S),title:r(i)("Deleting Orders"),width:"800px","close-on-click-modal":!1,"show-close":!1,"close-on-press-escape":!1,"modal-class":"fc-bulk-delete-action-dialog"},{footer:l(()=>[e("div",Ve,[o(x,{onClick:b[0]||(b[0]=S=>M()),disabled:u.value,type:"primary"},{default:l(()=>[C(n(u.value?r(i)("Processing..."):r(i)("Done")),1)]),_:1},8,["disabled"])])]),default:l(()=>[e("div",ye,[u.value?(s(),d("div",ge,[e("p",we,n(r(i)("Please do not close or refresh this window. Please wait while we delete the selected orders...")),1),m.value?(s(),d("p",ke,n(r(i)("Currently processing: %s",m.value)),1)):v("",!0)])):(s(),d("div",$e,[e("p",Ce,n(r(i)("Deletion completed")),1)])),o(N,{percentage:g.value,"stroke-width":6,striped:"","striped-flow":"",class:"mb-4 !mt-0",status:u.value?void 0:"success"},null,8,["percentage","status"]),e("div",xe,[o(E,{data:a.value,class:"w-full",size:"small"},{default:l(()=>[o(_,{label:r(i)("Invoice No."),"min-width":"120"},{default:l(S=>[e("span",Oe,n(S.row.invoice_no||S.row.id),1)]),_:1},8,["label"]),o(_,{label:r(i)("Status"),width:"150",align:"right"},{default:l(S=>[e("div",Te,[S.row.status!=="processing"?(s(),w(L,{key:0,name:p(S.row.status),class:G(["w-4 h-4 flex-none ",T(S.row.status)])},null,8,["name","class"])):(s(),w(A,{key:1,class:"is-loading text-blue-500"},{default:l(()=>[o(r(le))]),_:1})),e("span",Se,[S.row.status=="error"||S.row.status=="warning"?(s(),w(ne,{key:0,title:$(S.row.status),content:S.row.error_message},null,8,["title","content"])):(s(),d(D,{key:1},[C(n($(S.row.status)),1)],64))])])]),_:1},8,["label"])]),_:1},8,["data"])]),!u.value&&a.value.length?(s(),d("div",Ie,[e("div",Me,[e("span",null,n(r(i)("Total"))+": "+n(a.value.length),1),e("span",Ne,n(r(i)("Success"))+": "+n(a.value.filter(S=>S.status==="success").length),1),e("span",Ae,n(r(i)("Failed"))+": "+n(a.value.filter(S=>S.status==="error").length),1)])])):v("",!0),a.value.filter(S=>S.status==="warning").length?(s(),d("div",De,[e("p",Le,n(r(i)("We have found some completed orders that are not deletable (%s)",a.value.filter(S=>S.status==="warning").length)),1)])):v("",!0)])]),_:1},8,["modelValue","title"])])}}},Re={class:"fc-orders-table-wrap"},qe=["title"],He={key:1},Be={class:"fc-popover-box"},Ee={class:"fluent-cart-admin-pages"},je={class:"fc-popover-content relative overflow-x-auto"},Fe={class:"fc-product-orders-items"},ze={class:"variation-title"},Ue={key:0},Qe={class:"fc-popover-box-action"},We={key:0,class:"block w-full truncate mr-4"},Je={key:1,class:"block w-full truncate mr-4"},Ge={class:"fc-popover-box-action-icon"},Ke=["innerHTML"],Xe=["innerHTML"],Ye=["innerHTML"],Ze={class:"fc-status-group"},et=["src","alt"],tt={class:"fc-btn-group sm justify-end"},st={class:"table-cell"},so={__name:"OrdersTable",props:{orders:{type:Array,required:!0},emptyText:{type:String,required:!1,default:i("No orders found.")},columns:{type:Array,required:!1,default(){return["selection","customer","actions","status","order_items"]}},table:Object},setup(c,{expose:h}){const u=c,g=V([]);V(!1),V(0);const O=T=>u.columns.includes(T),a=T=>F.get(window,"fluentCartAdminApp.payment_logos."+T),m=F.get(window,"fluentCartAdminApp.receipt_page_url",!1)||!1,y=T=>T?X.appendQueryParams(window.fluentCartAdminApp.site_url,{"fluent-cart":"receipt",order_hash:T,download:1}):"",k=T=>T.filter($=>$.payment_type!=="signup_fee"),I=T=>{g.value=T.map($=>({id:$.id,parent_id:$.parent_id,invoice_no:$.invoice_no,status:$.status}))},p=()=>{u.table.fetch()};return h({selectedOrders:g}),(T,$)=>{const M=f("el-table-column"),t=f("router-link"),b=f("el-popover"),x=f("el-tag"),q=f("el-tooltip"),N=f("el-table");return s(),d("div",Re,[g.value.length?(s(),w(Pe,{key:0,"selected-orders":g.value,"on-complete":p},null,8,["selected-orders"])):v("",!0),o(N,{class:"w-full compact-table",data:c.orders,"tooltip-options":{popperClass:"fc-tooltip-long"},onSelectionChange:I},{empty:l(()=>[o(U,{icon:"Empty/Order","has-dark":"",text:c.emptyText},null,8,["text"])]),default:l(()=>[c.table&&c.table.data.showDeleteBulkAction?(s(),w(M,{key:0,type:"selection",width:"45"})):v("",!0),o(M,{width:140,label:r(i)("Date")},{default:l(_=>[o(P,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:_.row.id}}},{default:l(()=>[e("div",null,[e("div",{title:r(i)("Order ID: %s",_.row.id),class:"text-xs text-system-mid dark:text-gray-300 mb-0.5"},n(_.row.invoice_no),9,qe),o(Q,{"date-time":_.row.created_at,"with-time":!1},null,8,["date-time"])])]),_:2},1032,["to"])]),_:1},8,["label"]),O("customer")?(s(),w(M,{key:1,width:130,label:r(i)("Customer")},{default:l(_=>[_.row.customer?(s(),w(W,{key:0,customer:_.row.customer,"to-route":{name:"view_order",params:{order_id:_.row.id}}},null,8,["customer","to-route"])):(s(),d("span",He,n(r(i)("Customer Not Found")),1))]),_:1},8,["label"])):v("",!0),O("order_items")?(s(),w(M,{key:2,"min-width":200,label:r(i)("Items")},{default:l(_=>[e("div",Be,[o(b,{placement:"bottom-start",width:360,trigger:"click"},{reference:l(()=>{var A;return[e("div",Qe,[k(_.row.order_items).length===1?(s(),d("span",We,n((A=k(_.row.order_items)[0])==null?void 0:A.post_title),1)):(s(),d("span",Je,n(k(_.row.order_items).length)+" "+n(T.$t("items")),1)),e("div",Ge,[o(L,{name:"ChevronDown"})])])]}),default:l(()=>[e("div",Ee,[e("div",je,[e("div",Fe,[(s(!0),d(D,null,j(k(_.row.order_items),A=>(s(),d("p",{key:A.id},[o(t,{class:"title",to:{name:"product_edit",params:{product_id:A==null?void 0:A.post_id}}},{default:l(()=>[C(n(A.post_title),1)]),_:2},1032,["to"]),e("span",ze,[e("b",null,n(A.quantity),1),C(" x "+n(A.title),1)])]))),128)),k(_.row.order_items).length===0?(s(),d("p",Ue,n(r(i)("No products found!")),1)):v("",!0)])])])]),_:2},1024),o(P,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:_.row.id}}},{default:l(()=>$[0]||($[0]=[e("span",null,"Â ",-1)])),_:2,__:[0]},1032,["to"])])]),_:1},8,["label"])):v("",!0),o(M,{width:150,label:r(i)("Total")},{default:l(_=>[o(P,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:_.row.id}}},{default:l(()=>[parseInt(_.row.total_refund)?(s(),d(D,{key:1},[e("span",{class:"text-gray-700 line-through",innerHTML:r(H).formatNumber(_.row.total_amount,!0,!1,_.row.currency)},null,8,Xe),_.row.payment_status!="refunded"?(s(),d("span",{key:0,style:{"margin-left":"5px"},innerHTML:r(H).formatNumber(parseInt(_.row.total_amount)-parseInt(_.row.total_refund),!0,!1,_.row.currency)},null,8,Ye)):v("",!0)],64)):(s(),d("span",{key:0,innerHTML:r(H).formatNumber(_.row.total_amount,!0,!1,_.row.currency)},null,8,Ke))]),_:2},1032,["to"])]),_:1},8,["label"]),o(M,{width:150,label:r(i)("Payment Status")},{default:l(_=>[o(P,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:_.row.id}}},{default:l(()=>[e("div",Ze,[o(B,{status:_.row.payment_status,"hide-icon":!0},null,8,["status"]),a(_.row.payment_method)?(s(),d("span",{key:0,class:G(["img",_.row.payment_method])},[e("img",{src:a(_.row.payment_method),alt:r(R).headline(_.row.payment_method)},null,8,et)],2)):(s(),w(x,{key:1,type:"info",round:"",size:"small",class:"capitalize"},{default:l(()=>[C(n(r(R).headline(_.row.payment_method)),1)]),_:2},1024))])]),_:2},1032,["to"])]),_:1},8,["label"]),O("status")?(s(),w(M,{key:3,width:120,label:r(i)("Status")},{default:l(_=>[o(P,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:_.row.id}}},{default:l(()=>[(s(),w(B,{status:_.row.status,"hide-icon":!0,key:_.row.id},null,8,["status"]))]),_:2},1032,["to"])]),_:1},8,["label"])):v("",!0),O("type")?(s(),w(M,{key:4,width:140,label:r(i)("Order Type")},{default:l(_=>[e("span",null,n(r(R).headline(_.row.type)),1),o(Y,{order:_.row},null,8,["order"])]),_:1},8,["label"])):v("",!0),O("actions")&&r(m)?(s(),w(M,{key:5,width:"60",label:""},{default:l(_=>[e("div",tt,[e("div",st,[o(q,{content:r(i)("View Invoice"),placement:"top","popper-class":"fc-tooltip"},{default:l(()=>[o(se,{target:"_blank",href:y(_.row.uuid),size:"small",tag:"a",bg:"ghost"},{default:l(()=>[o(L,{name:"Print"})]),_:2},1032,["href"])]),_:2},1032,["content"])])])]),_:1})):v("",!0)]),_:1},8,["data"])])}}},ot={class:"fc-orders-table-mobile-wrap"},nt={class:"fc-orders-table-mobile-header"},lt=["onClick"],at=["title"],rt={class:"flex items-center gap-3"},it=["onClick"],ct=["innerHTML"],dt=["innerHTML"],ut=["innerHTML"],_t={key:0,class:"fc-order-table-actions-col"},mt={class:"el-dropdown-link"},pt=["href"],ft={key:0,class:"fc-orders-table-mobile-body"},ht={class:"fc-order-and-customer-info"},vt={key:0,class:"fc-order-table-customer-col"},bt={key:1},yt={key:1,class:"fc-order-table-order-items-col"},gt={class:"fc-popover-box"},wt={class:"fluent-cart-admin-pages"},kt={class:"fc-popover-content relative overflow-x-auto"},$t={class:"fc-product-orders-items"},Ct={class:"variation-title"},xt={key:0},Ot={class:"fc-popover-box-action"},Tt={key:0,class:"fc-order-count-text"},St={key:1,class:"fc-order-count-text"},It={class:"fc-popover-box-action-icon"},Mt=["onClick"],Nt={class:"fc-status-and-order-type-wrap"},At={class:"fc-order-table-payment-status-col"},Dt={class:"title"},Lt={class:"fc-status-group"},Vt=["src","alt"],Pt={key:0,class:"fc-order-table-status-col"},Rt={class:"title"},qt={key:1,class:"fc-order-table-order-type-col"},Ht={class:"title"},Bt={class:"type"},Et={key:0,class:"py-6 text-center"},oo={__name:"OrdersTableMobile",props:{orders:{type:Array,required:!0},emptyText:{type:String,required:!1,default:i("No orders found.")},columns:{type:Array,required:!1,default(){return["selection","customer","actions","status","order_items"]}},table:Object},setup(c){const h=c,u=m=>h.columns.includes(m),g=m=>F.get(window,"fluentCartAdminApp.payment_logos."+m);F.get(window,"fluentCartAdminApp.receipt_page_url",!1);const O=m=>m?X.appendQueryParams(window.fluentCartAdminApp.site_url,{"fluent-cart":"receipt",order_hash:m,download:1}):"",a=m=>m.filter(y=>y.payment_type!=="signup_fee");return(m,y)=>{const k=f("el-dropdown-item"),I=f("el-dropdown-menu"),p=f("el-dropdown"),T=f("router-link"),$=f("el-popover"),M=f("el-tag");return s(),d("div",ot,[(s(!0),d(D,null,j(c.orders,(t,b)=>(s(),d("div",{key:t.id,class:"fc-orders-table-mobile-row"},[e("div",nt,[e("div",{class:"fc-order-table-date-col",onClick:x=>m.$router.push({name:"view_order",params:{order_id:t.id}})},[o(Q,{class:"date","date-time":t.created_at,"with-time":!1},null,8,["date-time"]),y[0]||(y[0]=e("span",{class:"bullet"},"â¢",-1)),e("div",{title:r(i)("Order ID: %s",t.id),class:"invoice-no"},n(t.invoice_no),9,at)],8,lt),e("div",rt,[e("div",{class:"fc-order-table-total-col",onClick:x=>m.$router.push({name:"view_order",params:{order_id:t.id}})},[parseInt(t.total_refund)?(s(),d(D,{key:1},[e("span",{class:"text-gray-700 line-through",innerHTML:r(H).formatNumber(t.total_amount,!0,!1,t.currency)},null,8,dt),t.payment_status!="refunded"?(s(),d("span",{key:0,class:"ml-1",innerHTML:r(H).formatNumber(parseInt(t.total_amount)-parseInt(t.total_refund),!0,!1,t.currency)},null,8,ut)):v("",!0)],64)):(s(),d("span",{key:0,innerHTML:r(H).formatNumber(t.total_amount,!0,!1,t.currency)},null,8,ct))],8,it),u("actions")?(s(),d("div",_t,[o(p,{trigger:"click","popper-class":"fc-dropdown"},{dropdown:l(()=>[o(I,null,{default:l(()=>[o(k,{class:"item-link"},{default:l(()=>[e("a",{target:"_blank",href:O(t.uuid)},[o(L,{name:"Print"}),C(" "+n(r(i)("View Invoice")),1)],8,pt)]),_:2},1024)]),_:2},1024)]),default:l(()=>[e("span",mt,[o(L,{name:"More",class:"w-1"})])]),_:2},1024)])):v("",!0)])]),u("customer")||u("order_items")?(s(),d("div",ft,[e("div",ht,[u("customer")?(s(),d("div",vt,[t.customer?(s(),w(W,{key:0,customer:t.customer,"to-route":{name:"view_order",params:{order_id:t.id}}},null,8,["customer","to-route"])):(s(),d("span",bt,n(r(i)("Customer Not Found")),1))])):v("",!0),u("order_items")?(s(),d("div",yt,[e("div",gt,[o($,{placement:"bottom-start",width:360,trigger:"click"},{reference:l(()=>{var x;return[e("div",Ot,[a(t.order_items).length===1?(s(),d("span",Tt,n((x=a(t.order_items)[0])==null?void 0:x.post_title),1)):(s(),d("span",St,n(a(t.order_items).length)+" "+n(m.$t("items")),1)),e("div",It,[o(L,{name:"ChevronDown"})])])]}),default:l(()=>[e("div",wt,[e("div",kt,[e("div",$t,[(s(!0),d(D,null,j(a(t.order_items),x=>(s(),d("p",{key:x.id},[o(T,{class:"title",to:{name:"product_edit",params:{product_id:x==null?void 0:x.post_id}}},{default:l(()=>[C(n(x.post_title),1)]),_:2},1032,["to"]),e("span",Ct,[e("b",null,n(x.quantity),1),C(" x "+n(x.title),1)])]))),128)),a(t.order_items).length===0?(s(),d("p",xt,n(r(i)("No products found!")),1)):v("",!0)])])])]),_:2},1024)])])):v("",!0)])])):v("",!0),e("div",{class:"fc-orders-table-mobile-footer",onClick:x=>m.$router.push({name:"view_order",params:{order_id:t.id}})},[e("div",Nt,[e("div",At,[e("div",Dt,n(r(i)("Payment Status")),1),e("div",Lt,[o(B,{status:t.payment_status,"hide-icon":!0},null,8,["status"]),g(t.payment_method)?(s(),d("span",{key:0,class:G(["img",t.payment_method])},[e("img",{src:g(t.payment_method),alt:r(R).headline(t.payment_method)},null,8,Vt)],2)):(s(),w(M,{key:1,type:"info",round:"",size:"small",class:"capitalize"},{default:l(()=>[C(n(r(R).headline(t.payment_method)),1)]),_:2},1024))])]),u("status")?(s(),d("div",Pt,[e("div",Rt,n(r(i)("Status")),1),(s(),w(B,{status:t.status,"hide-icon":!0,key:t.id},null,8,["status"]))])):v("",!0),u("type")?(s(),d("div",qt,[e("div",Ht,n(r(i)("Order Type")),1),e("span",Bt,n(r(R).headline(t.type)),1),o(Y,{order:t},null,8,["order"])])):v("",!0)])],8,Mt)]))),128)),c.orders.length===0?(s(),d("div",Et,[o(U,{icon:"Empty/Order","has-dark":"",text:c.emptyText},null,8,["text"])])):v("",!0)])}}},jt={key:0,class:"text"},Ft={class:"font-medium"},zt=["innerHTML"],Ut={class:"purchase-values"},Qt=["innerHTML"],Wt={key:1},Jt=["innerHTML"],Gt={key:1,class:"text"},no={__name:"CustomerPurchaseValue",props:{value:{type:[Object,String],required:!0}},setup(c){const h=c,u=J(()=>{if(typeof h.value=="string")try{return JSON.parse(h.value)}catch{return{}}return h.value&&typeof h.value=="object"?h.value:{}}),g=J(()=>{const a=Object.entries(u.value||{});if(!a.length)return{currency:"",value:0};const[m,y]=a[0];return{currency:m,value:y}}),O=J(()=>Object.entries(u.value||{}).slice(1).map(([m,y])=>({currency:m,value:y})));return(a,m)=>{const y=f("el-popover");return Object.keys(u.value).length?(s(),d("span",jt,[O.value.length?(s(),w(y,{key:0,placement:"bottom",trigger:"hover","popper-class":"fc-popover"},{reference:l(()=>[e("span",Ft,[e("span",{innerHTML:a.formatNumber(g.value.value,!0,!1,g.value.currency)},null,8,zt),C(" +"+n(O.value.length),1)])]),default:l(()=>[e("div",Ut,[(s(!0),d(D,null,j(O.value,(k,I)=>(s(),d("div",{key:k.currency,class:"purchase-value-item"},[e("span",{innerHTML:a.formatNumber(k.value,!0,!1,k.currency)},null,8,Qt)]))),128))])]),_:1})):(s(),d("span",Wt,[e("span",{innerHTML:a.formatNumber(g.value.value,!0,!1,g.value.currency)},null,8,Jt)])),C(" "+n(r(i)("Lifetime Value")),1)])):(s(),d("span",Gt,n(r(i)("Lifetime Value"))+": "+n(r(i)("No Data")),1))}}},Kt={name:"SubscriptionsTable",emits:["fetch"],props:{subscriptions:{type:Array,required:!0},columns:{type:Array,required:!1,default(){return["customer","next_billing_date","collection_method","bills_count","payment_method","valid_till"]}}},components:{ConvertedTime:Q,RouteCell:P,Badge:B,DynamicIcon:L,ArrowDown:Z,Empty:U,CustomerInfoPopover:W},computed:{Str(){return R}},methods:{translate:i,subscriptionStatus(c){return c==null?void 0:c.status}}},Xt={class:"fc-subscriptions-table-wrap"},Yt={key:1},Zt={class:"truncate"},es=["innerHTML"];function ts(c,h,u,g,O,a){const m=f("RouteCell"),y=f("el-table-column"),k=f("CustomerInfoPopover"),I=f("Badge"),p=f("ConvertedTime"),T=f("router-link"),$=f("Empty"),M=f("el-table");return s(),d("div",Xt,[o(M,{data:u.subscriptions,class:"w-full compact-table","tooltip-options":{popperClass:"fc-tooltip-long"}},{empty:l(()=>[o($,{icon:"Empty/ListView","has-dark":!0,text:a.translate("No subscriptions found.")},null,8,["text"])]),default:l(()=>[o(y,{fixed:"",label:a.translate("ID"),width:"100"},{default:l(t=>{var b;return[o(m,{class:"link block",to:{name:"view_subscription",params:{subscription_id:(b=t.row)==null?void 0:b.id}}},{default:l(()=>[C(" #"+n(t.row.id),1)]),_:2},1032,["to"])]}),_:1},8,["label"]),u.columns.indexOf("customer")!==-1?(s(),w(y,{key:0,label:a.translate("Customer"),width:150},{default:l(t=>{var b;return[t.row.customer?(s(),w(k,{key:0,customer:t.row.customer,"to-route":{name:"view_subscription",params:{subscription_id:(b=t.row)==null?void 0:b.id}}},null,8,["customer","to-route"])):(s(),d("span",Yt,n(a.translate("Customer Not Found")),1))]}),_:1},8,["label"])):v("",!0),o(y,{label:a.translate("Product"),width:"360","show-overflow-tooltip":""},{default:l(t=>{var b;return[o(m,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(b=t.row)==null?void 0:b.id}}},{default:l(()=>[e("div",Zt,n(t.row.item_name),1)]),_:2},1032,["to"])]}),_:1},8,["label"]),o(y,{label:a.translate("Status"),width:"120"},{default:l(t=>{var b;return[o(m,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(b=t.row)==null?void 0:b.id}}},{default:l(()=>[(s(),w(I,{status:a.subscriptionStatus(t.row),key:t.row.id,size:"small","hide-icon":!0},null,8,["status"]))]),_:2},1032,["to"])]}),_:1},8,["label"]),o(y,{label:a.translate("Billing"),width:"230"},{default:l(t=>{var b;return[o(m,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(b=t.row)==null?void 0:b.id}}},{default:l(()=>[e("span",{innerHTML:t.row.payment_info},null,8,es)]),_:2},1032,["to"])]}),_:1},8,["label"]),o(y,{label:a.translate("Created At"),width:"130"},{default:l(t=>{var b;return[o(m,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(b=t.row)==null?void 0:b.id}}},{default:l(()=>[o(p,{"date-time":t.row.created_at,"with-time":!1},null,8,["date-time"])]),_:2},1032,["to"])]}),_:1},8,["label"]),u.columns.indexOf("next_billing_date")!==-1?(s(),w(y,{key:1,label:a.translate("Next Billing Date"),width:"160"},{default:l(t=>{var b;return[o(m,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(b=t.row)==null?void 0:b.id}}},{default:l(()=>[o(p,{"date-time":t.row.next_billing_date,"with-time":!1},null,8,["date-time"])]),_:2},1032,["to"])]}),_:1},8,["label"])):v("",!0),u.columns.indexOf("collection_method")!==-1?(s(),w(y,{key:2,label:a.translate("Collection Method"),width:"160"},{default:l(t=>{var b;return[o(m,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(b=t.row)==null?void 0:b.id}}},{default:l(()=>[C(n(t.row.collection_method),1)]),_:2},1032,["to"])]}),_:1},8,["label"])):v("",!0),u.columns.indexOf("bills_count")!==-1?(s(),w(y,{key:3,label:a.translate("Bills Count"),width:"100"},{default:l(t=>[C(n(t.row.bill_count),1)]),_:1},8,["label"])):v("",!0),u.columns.indexOf("payment_method")!==-1?(s(),w(y,{key:4,label:a.translate("Payment Method"),width:"150"},{default:l(t=>[C(n(t.row.current_payment_method?a.Str.headline(t.row.current_payment_method.trim().replace(/_/g,"-")):"-"),1)]),_:1},8,["label"])):v("",!0),u.columns.indexOf("order_id")!==-1?(s(),w(y,{key:5,label:a.translate("Order ID"),width:"100"},{default:l(t=>[o(T,{class:"link",to:{name:"view_order",params:{order_id:t.row.parent_order_id}}},{default:l(()=>[C(" #"+n(t.row.parent_order_id),1)]),_:2},1032,["to"])]),_:1},8,["label"])):v("",!0)]),_:1},8,["data"])])}const lo=ee(Kt,[["render",ts]]),ss={name:"SubscriptionsTableMobile",emits:["fetch"],props:{subscriptions:{type:Array,required:!0},columns:{type:Array,required:!1,default(){return["customer","next_billing_date","collection_method","bills_count","payment_method","valid_till"]}}},components:{ConvertedTime:Q,RouteCell:P,Badge:B,DynamicIcon:L,ArrowDown:Z,Empty:U,CustomerInfoPopover:W},computed:{Str(){return R}},methods:{translate:i,subscriptionStatus(c){return c==null?void 0:c.status}}},os={class:"fc-table-mobile-wrap fc-subscriptions-table-mobile-wrap"},ns=["onClick"],ls={class:"fc-table-mobile-header-left"},as={class:"fc-table-status-col"},rs={class:"fc-table-id-col"},is={class:"id"},cs={class:"fc-table-mobile-body"},ds={key:0,class:"fc-table-customer-col"},us=["onClick"],_s={class:"fc-table-product-col"},ms={class:"product-name"},ps={class:"fc-table-billing-col"},fs={class:"title"},hs=["innerHTML"],vs={class:"fc-table-mobile-footer"},bs={class:"fc-table-mobile-footer-row cols-3"},ys=["onClick"],gs={class:"title"},ws=["onClick"],ks={class:"title"},$s=["onClick"],Cs={class:"title"},xs={class:"value"},Os=["onClick"],Ts={class:"title"},Ss={class:"value"},Is=["onClick"],Ms={class:"title"},Ns={class:"value"},As=["onClick"],Ds={class:"title"},Ls={class:"value"},Vs={key:0,class:"py-6 text-center"};function Ps(c,h,u,g,O,a){const m=f("Badge"),y=f("CustomerInfoPopover"),k=f("ConvertedTime"),I=f("Empty");return s(),d("div",os,[(s(!0),d(D,null,j(u.subscriptions,(p,T)=>(s(),d("div",{key:p.id,class:"fc-table-mobile-row"},[e("div",{class:"fc-table-mobile-header",onClick:$=>c.$router.push({name:"view_subscription",params:{subscription_id:p.id}})},[e("div",ls,[e("div",as,[(s(),w(m,{status:a.subscriptionStatus(p),key:p.id},null,8,["status"]))]),e("div",rs,[e("div",is,"#"+n(p.id),1)])])],8,ns),e("div",cs,[u.columns.indexOf("customer")!==-1?(s(),d("div",ds,[o(y,{customer:p.customer,"to-route":{name:"view_subscription",params:{subscription_id:p==null?void 0:p.id}}},null,8,["customer","to-route"])])):v("",!0),e("div",{onClick:$=>c.$router.push({name:"view_subscription",params:{subscription_id:p.id}})},[e("div",_s,[e("div",ms,n(p.item_name),1)]),e("div",ps,[e("div",fs,n(a.translate("Billing:")),1),e("span",{innerHTML:p.payment_info},null,8,hs)])],8,us)]),e("div",vs,[e("div",bs,[e("div",{class:"fc-table-created-at-col",onClick:$=>c.$router.push({name:"view_subscription",params:{subscription_id:p.id}})},[e("div",gs,n(a.translate("Created At")),1),o(k,{class:"value","date-time":p.created_at,"with-time":!1},null,8,["date-time"])],8,ys),u.columns.indexOf("next_billing_date")!==-1?(s(),d("div",{key:0,class:"fc-table-next-bill-date-col",onClick:$=>c.$router.push({name:"view_subscription",params:{subscription_id:p.id}})},[e("div",ks,n(a.translate("Next Billing")),1),o(k,{class:"value","date-time":p.next_billing_date,"with-time":!1},null,8,["date-time"])],8,ws)):v("",!0),u.columns.indexOf("bills_count")!==-1?(s(),d("div",{key:1,class:"fc-table-bill-count-col",onClick:$=>c.$router.push({name:"view_subscription",params:{subscription_id:p.id}})},[e("div",Cs,n(a.translate("Bills Count")),1),e("div",xs,n(p.bill_count),1)],8,$s)):v("",!0),u.columns.indexOf("payment_method")!==-1?(s(),d("div",{key:2,class:"fc-table-payment-method-col",onClick:$=>c.$router.push({name:"view_subscription",params:{subscription_id:p.id}})},[e("div",Ts,n(a.translate("Payment Method")),1),e("div",Ss,n(p.current_payment_method?a.Str.headline(p.current_payment_method.trim().replace(/_/g,"-")):"-"),1)],8,Os)):v("",!0),u.columns.indexOf("order_id")!==-1?(s(),d("div",{key:3,class:"fc-table-order-id-col",onClick:$=>c.$router.push({name:"view_order",params:{order_id:p.parent_order_id}})},[e("div",Ms,n(a.translate("Order ID")),1),e("div",Ns,"#"+n(p.parent_order_id),1)],8,Is)):v("",!0),u.columns.indexOf("collection_method")!==-1?(s(),d("div",{key:4,class:"fc-table-collection-method-col",onClick:$=>c.$router.push({name:"view_subscription",params:{subscription_id:p.id}})},[e("div",Ds,n(a.translate("Collection")),1),e("div",Ls,n(p.collection_method),1)],8,As)):v("",!0)])])]))),128)),u.subscriptions.length===0?(s(),d("div",Vs,[o(I,{icon:"Empty/ListView","has-dark":"",text:a.translate("No subscriptions found.")},null,8,["text"])])):v("",!0)])}const ao=ee(ss,[["render",Ps]]),Rs={class:"dialog-footer"},qs={name:"CancelSubscription",props:["subscription","orderId","modelValue"],data(){return{cancelReason:"customer_request",cancelling:!1,otherReason:""}},computed:{updatedModelValue:{get(){return this.modelValue},set(c){this.modelValue=c}},otherReasonError(){return this.cancelReason==="other"&&this.otherReason.trim()===""?i("Please enter a reason"):""}},methods:{cancelSubscription(){if(this.cancelling=!0,this.cancelReason==="other"){if(this.otherReason.trim()===""){this.$notify.error(i("Please enter a reason")),this.cancelling=!1;return}this.cancelReason=this.otherReason}this.$put(`orders/${this.orderId}/subscriptions/${this.subscription.id}/cancel`,{cancel_reason:this.cancelReason}).then(c=>{this.cancelling=!0,this.$notify({type:"success",title:i("Success"),message:i("Subscription canceled successfully")}),this.$emit("reload")}).catch(c=>{this.cancelling=!0,c.status_code=="422"?z.validationErrors(c):z.error(c)}).finally(()=>{this.cancelling=!0,this.cancelSubscriptionModal=!1})}}},ro=Object.assign(qs,{setup(c){return(h,u)=>{const g=f("el-option"),O=f("el-select"),a=f("el-form-item"),m=f("el-input"),y=f("el-form"),k=f("el-button"),I=f("el-dialog");return s(),w(I,{"model-value":h.updatedModelValue,loading:h.cancelling,title:r(i)("Cancel Subscription"),width:"500"},{footer:l(()=>[e("div",Rs,[o(k,{onClick:u[2]||(u[2]=p=>h.$emit("close"))},{default:l(()=>[C(n(r(i)("Cancel")),1)]),_:1}),o(k,{loading:h.cancelling,type:"warning",onClick:h.cancelSubscription},{default:l(()=>[C(n(r(i)("Cancel Subscription")),1)]),_:1},8,["loading","onClick"])])]),default:l(()=>[o(y,{"label-position":"top"},{default:l(()=>[e("div",null,n(r(i)("Are you sure to cancel the subscription?")),1),u[3]||(u[3]=e("br",null,null,-1)),o(a,{label:r(i)("Cancellation reason"),required:""},{default:l(()=>[o(O,{modelValue:h.cancelReason,"onUpdate:modelValue":u[0]||(u[0]=p=>h.cancelReason=p)},{default:l(()=>[o(g,{label:r(i)("Refunded"),value:"refunded"},null,8,["label"]),o(g,{label:r(i)("Customer request"),value:"customer_request"},null,8,["label"]),o(g,{label:r(i)("Completed (EOT)"),value:"completed"},null,8,["label"]),o(g,{label:r(i)("Fraudulent"),value:"fraudulent"},null,8,["label"]),o(g,{label:r(i)("Other"),value:"other"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),h.cancelReason==="other"?(s(),w(a,{key:0,label:r(i)("Other Reason"),required:"",error:h.otherReasonError},{default:l(()=>[o(m,{modelValue:h.otherReason,"onUpdate:modelValue":u[1]||(u[1]=p=>h.otherReason=p)},null,8,["modelValue"])]),_:1},8,["label","error"])):v("",!0)]),_:1,__:[3]})]),_:1},8,["model-value","loading","title"])}}});export{ao as S,Q as _,so as a,oo as b,no as c,lo as d,ro as e};
