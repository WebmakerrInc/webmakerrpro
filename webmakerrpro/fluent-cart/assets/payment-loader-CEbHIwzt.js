var R=Object.defineProperty;var x=i=>{throw TypeError(i)};var j=(i,t,e)=>t in i?R(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var g=(i,t,e)=>j(i,typeof t!="symbol"?t+"":t,e),A=(i,t,e)=>t.has(i)||x("Cannot "+e);var n=(i,t,e)=>(A(i,t,"read from private field"),e?e.call(i):t.get(i)),u=(i,t,e)=>t.has(i)?x("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),l=(i,t,e,o)=>(A(i,t,"write to private field"),o?o.call(i,e):t.set(i,e),e);const y=class y{static handleFragments(t){t.forEach(e=>{const o=document.querySelector(e.selector);o&&(e.type==="replace"?o.innerHTML=e.content:o.insertAdjacentHTML("beforeend",e.content))}),window.dispatchEvent(new CustomEvent("fluentCartNotifySummaryViewUpdated"))}static handleSummaryViewUpdated(){fetch(y.buildUrl(`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_checkout_routes&fc_checkout_action=get_checkout_summary_view`).toString(),{headers:{"X-WP-Nonce":window.fluentCartRestVars.rest.nonce},credentials:"include"}).then(t=>t.json()).then(t=>{this.handleFragments(t.fragments),window.dispatchEvent(new CustomEvent("fluentCartCheckoutDataChanged",{detail:{response:t}}))}).catch(t=>{console.error("Error rendering checkout summary:",t)})}static getParams(){var c,s;const t=new URLSearchParams(window.location.search),e={};t.has("fct_cart_hash")&&(e.fct_cart_hash=t.get("fct_cart_hash")),t.has("quantity")&&(e.quantity=t.get("quantity"));const o=(c=window.fluentCartCouponService)==null?void 0:c.getCoupons();Array.isArray(o)&&o.length>0&&(e.coupons=o.join(","));const a=(s=window.fluent_cart_shipping_service)==null?void 0:s.currentShippingMethodId;return a&&(e.shipping_method_id=a),e}static buildUrl(t,e={}){const o={get(a,c){return c==="toString"||c==="valueOf"||c===Symbol.toPrimitive?()=>y._build(a.rawUrl,e):c==="rawUrl"?a.rawUrl:Reflect.get(a,c)}};return new Proxy({rawUrl:t},o)}static _build(t,e){var a,c;const o=new URLSearchParams(window.location.search);y.quantity==null&&(y.quantity=o.get("quantity")||1);for(const[s,h]of Object.entries(e))o.set(s,h);try{const s=new URL(t);for(const[b,k]of o)s.searchParams.set(b,k);s.searchParams.set("quantity",y.quantity);const h=(a=window.fluentCartCouponService)==null?void 0:a.getCoupons();Array.isArray(h)&&h.length>0&&s.searchParams.set("coupons",h.join(","));const p=(c=window.fluent_cart_shipping_service)==null?void 0:c.currentShippingMethodId;return p&&s.searchParams.set("shipping_method_id",p),s.href}catch(s){return console.error("Error building URL:",s),t}}};g(y,"quantity",null);let U=y;var r,P,v,q,C,w,f,d,_;class H{constructor({form:t,orderHandler:e,checkoutHandler:o=null,customPayment:a=!1}){u(this,r);g(this,"payMethod");u(this,P,`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_checkout_routes&fc_checkout_action=get_order_info`);u(this,v);g(this,"checkoutHandler");g(this,"customPayment");u(this,q);u(this,C,null);u(this,w,!1);u(this,f,!1);u(this,d,null);u(this,_,window.fluentcart.$t);var h,p,b,k,E;l(this,v,e),l(this,r,t),this.payMethod=(h=n(this,r).querySelector('input[name="_fct_pay_method"]:checked'))==null?void 0:h.value,this.checkoutHandler=o,l(this,d,o.checkoutUiService),this.customPayment=a,l(this,w,((p=window.fluentcart_checkout_info)==null?void 0:p.is_zero_payment)==="yes"),l(this,f,((b=window.fluentcart_checkout_info)==null?void 0:b.has_subscription)==="yes"),this.buttons=n(this,r).querySelector("[data-fluent-cart-checkout-page-checkout-button]"),this.paymenMethodsWithCustomCheckoutButtons=(k=window.fluentcart_checkout_vars)==null?void 0:k.payment_methods_with_custom_checkout_buttons,l(this,q,(E=window.fluentcart_checkout_vars)==null?void 0:E.submit_button);const c=n(this,r).querySelector('input[name="_fct_pay_method"]:checked');c&&(n(this,r).querySelectorAll('input[name="_fct_pay_method"]').forEach(m=>{m.parentNode.classList.remove("active")}),c.parentNode.classList.add("active")),this.paymenMethodsWithCustomCheckoutButtons.includes(this.payMethod)&&(n(this,d).hideCheckoutButton(),n(this,d).enableCheckoutButton());const s=n(this,r).querySelectorAll('input[name="_fct_pay_method"]');s.forEach(m=>{m.addEventListener("change",()=>{var S;this.payMethod=(S=n(this,r).querySelector('input[name="_fct_pay_method"]:checked'))==null?void 0:S.value,s.forEach(L=>L.parentNode.classList.remove("active")),m.parentNode.classList.add("active"),this.paymenMethodsWithCustomCheckoutButtons.includes(this.payMethod)?(n(this,d).hideCheckoutButton(),n(this,d).enableCheckoutButton()):(n(this,d).showCheckoutButton(),n(this,d).enableCheckoutButton()),document.querySelectorAll(".fluent-cart-checkout_embed_payment_container").forEach(L=>{L.style.display="none"});const B=m.parentNode.querySelector(".fluent-cart-checkout_embed_payment_container");B&&(B.style.display="block",this.load(this.payMethod))})}),window.addEventListener("fluentCartCheckoutDataChanged",m=>{var M;this.checkTotal((M=m.detail)==null?void 0:M.response)})}checkTotal(t){(t==null?void 0:t.total)!==n(this,C)&&((t==null?void 0:t.total)>0?l(this,w,!1):(t==null?void 0:t.total)<=0&&!n(this,f)&&l(this,w,!0),l(this,C,t==null?void 0:t.total),this.togglePaymentMethods(t))}decodeHtml(t){const e=document.createElement("textarea");return e.innerHTML=t,e.value}togglePaymentMethods(t,e=!1){var a;let o=0;if(e?(o=0,l(this,f,!1)):(o=t==null?void 0:t.total,l(this,f,!!(t!=null&&t.has_subscriptions))),!n(this,f)&&o<=0){if(n(this,r).querySelectorAll('input[name="_fct_pay_method"]').length===0)return;const s=n(this,r).querySelector("[data-fluent-cart-checkout-payment-methods]");s.style.display="none",this.payMethod="offline_payment",n(this,r).querySelector('input[name="_fct_pay_method"]').checked=!1,n(this,r).querySelectorAll('input[name="_fct_pay_method"]').forEach(h=>{h.checked=!1,h.removeAttribute("checked")}),window.is_offline_payment_ready=!0,n(this,d).showCheckoutButton(),n(this,d).enableCheckoutButton()}else{const c=n(this,r).querySelector("[data-fluent-cart-checkout-payment-methods]");c.style.display="block";let s=(a=n(this,r).querySelector('input[name="_fct_pay_method"]:checked'))==null?void 0:a.value;if(this.payMethod=s,s)this.load(s);else{const h=n(this,r).querySelector('input[name="_fct_pay_method"]');h&&(h.checked=!0,h.dispatchEvent(new Event("change")),this.payMethod=h.value)}}}disableCheckoutButton(t){n(this,r).classList.add("fluent-cart-checkout-order-processing"),n(this,d).disableCheckoutButton(),n(this,d).setCheckoutButtonText(t)}enableCheckoutButton(t){n(this,r).classList.add("fluent-cart-checkout-order-processing"),n(this,d).enableCheckoutButton(),n(this,d).setCheckoutButtonText(t)}showCheckoutButton(){this.buttons.style.display="block",this.buttons.disabled=!1}triggerPaymentCompleteEvent(t){var a;const e=new URLSearchParams({action:"fluent_cart_run_order_actions",order_hash:(a=t==null?void 0:t.order)==null?void 0:a.uuid}),o=new XMLHttpRequest;o.open("POST",window.fluentcart_checkout_vars.ajaxurl,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onload=function(){o.status>=200&&o.status<300||console.error("Network response was not ok")},o.send(e.toString())}load(t){var s,h,p;if(t==null&&(t=(s=n(this,r).querySelector('input[name="_fct_pay_method"]:checked'))==null?void 0:s.value),this.payMethod=t,n(this,w)&&!n(this,f))return this.togglePaymentMethods({},!0);window["is_"+t+"_ready"]=!0;let e=new URLSearchParams(window.location.search);const o=n(this,P);let a={method:t};(h=window.fluentcart_checkout_info)!=null&&h.paymentMode&&(a.mode=window.fluentcart_checkout_info.paymentMode),(p=window.fluentcart_checkout_info)!=null&&p.orderHash&&(a.order_hash=window.fluentcart_checkout_info.orderHash),e.has("mode")&&e.get("variation_id")&&(a.mode=e.get("mode"),a.variation_id=e.get("variation_id"));const c=U.buildUrl(o.toString(),a).toString();window.dispatchEvent(new CustomEvent("fluent_cart_load_payments_"+t,{detail:{form:n(this,r),paymentInfoUrl:c,nonce:window.fluentcart_checkout_info.checkout_nonce,orderHandler:n(this,v),paymentLoader:this,isZeroPayment:n(this,w),hasSubscriptions:n(this,f)}}))}changeLoaderStatus(t){const e=document.querySelector(".fc-order-processing .loading-status");if(!e)return;const o={processing:n(this,_).call(this,"Payment Processing..."),confirming:n(this,_).call(this,"Confirming Payment..."),completed:n(this,_).call(this,"Payment completed! Updating order..."),redirecting:n(this,_).call(this,"Redirecting to receipt..."),failed:n(this,_).call(this,"Payment failed!"),canceled:n(this,_).call(this,"Payment canceled!"),rejected:n(this,_).call(this,"Payment Process rejected!")};e.textContent=o[t]||t}hideLoader(){const t=document.querySelector(".fc-order-processing");t&&t.classList.add("hidden")}getPaymentMethod(){return this.payMethod}}r=new WeakMap,P=new WeakMap,v=new WeakMap,q=new WeakMap,C=new WeakMap,w=new WeakMap,f=new WeakMap,d=new WeakMap,_=new WeakMap;export{U as C,H as P};
