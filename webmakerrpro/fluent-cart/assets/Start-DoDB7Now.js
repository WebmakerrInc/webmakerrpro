import{i as h,R as ve,j as pe,a as x,c as p,o as u,d as S,w as P,u as b,f as s,e as ee,F as I,h as B,b as R,g as te,t as k,A as $,a5 as _e}from"./vue.esm-bundler-VLZRLwDo.js";import{u as me}from"./useElementPlusComponents-9-lBhqZz.js";import{_ as fe}from"./AddProductItemModal-Cct32p6L.js";import{t as g}from"./Translator-B6cROAk_.js";import{u as he}from"./useElementor-CLTCC9L5.js";import{R as ae}from"./Rest-U7WPPDzn.js";import{A as ge}from"./Arr-MwYQQ3qa.js";import{S as be}from"./ServerSidePreview-DACprjpn.js";import{n as ye}from"./Notify-DKZN7muO.js";import Ve from"./CaretRight-xTaCqboq.js";import Ce from"./Delete-D5svjAUE.js";import"./index-BSdFqZUc.js";import"./index-DXJWUF1E.js";import"./dayjs.min-2rai63wT.js";import"./index-CA48fF9Y.js";import"./DynamicIcon-B1vpMEi_.js";import"./Str-DQr93RbR.js";import"./productService-CeLFdK8B.js";import"./Model-D7MrDQPf.js";import"./Asset-CBhXzPc7.js";import"./Url-DcFY6RBb.js";/* empty css                                                                          */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./add-query-args-COp5A_Oq.js";const Se={key:0},ke={key:1,class:"fluent-cart-pricing-table-block-editor"},we={class:"fluent-cart-pricing-table-block-editor-head"},Ae={class:"fluent-cart-pricing-table-block-editor-body"},je={key:0,class:"fc-custom-tabs"},Ee={key:0,class:"fc-tab-header"},Oe={class:"fc-tab-content"},xe={key:0,class:"fc-tab-content-inner"},De={class:"fc-active-product-select-container"},Te={class:"fc-form-group"},Ie={class:"fc-selected-products-container"},Ne=["onClick"],Fe={class:"icon"},Pe={class:"fc-selected-product-contents"},Be=["title"],Re={class:"product-id"},$e={class:"product-textarea-inner"},Ue=["placeholder","value","onBlur"],Me={class:"hint-text"},Qe=["onClick","title"],He={key:1},Je={__name:"App",props:{settings:{type:String,default:""}},setup(y){let v=null;const w=y,d=h(w.settings),D=h({}),U=h([]),r=h([]),i=h(0),A=h({}),E=h({}),o=h([]),M=h([]),T=h("editor"),Q=(e,t)=>{J(e),d.value.variations=e;let a={};t.forEach(l=>{l.variants.forEach(_=>{e.includes(_.id)&&(a[_.id]={other_info:_.other_info,variation_title:_.variation_title,id:_.id})})}),D.value={...a},U.value=Object.keys(a),H(a)},ne=e=>{const t={};Object.keys(E.value).forEach(a=>{t[a]=!1}),t[e]=!E.value[e],E.value=t},oe=(e,t)=>{ae.put("/products/variants/"+e+"/pricing-table",{description:t.other_info.description}).then(a=>{}).catch(a=>{console.error("Error updating variation data:",a),ye.error(g("Failed to update variation data"))})},ie=e=>{let t={...D.value};e in t&&delete t[e],D.value={...t},U.value=Object.keys(t),Array.isArray(o.value)?o.value=o.value.filter(l=>l.toString()!==e.toString()):typeof o.value=="string"&&(o.value=o.value.split(",").filter(l=>l!==e));let a=[];typeof o.value=="string"?a=o.value.split(",").map(Number):Array.isArray(o.value)&&(a=o.value.map(l=>parseInt(l,10))),J(o.value),d.value.variations=a,H(D.value)},H=(e,t="repeat_interval")=>{let a="repeat_interval";t==="payment_type"?a="payment_type":t==="none"&&(a="onetime");const l={};Object.entries(e).forEach(([V,m])=>{var C;let f=((C=m.other_info)==null?void 0:C[a])||"onetime";m.other_info&&m.other_info.installment==="yes"&&(f="installment"),l[f]||(l[f]={}),l[f][V]={id:V,other_info:m.other_info,variation_title:m.variation_title}});const _=Object.keys(l).map(V=>({title:V,content:Object.entries(l[V]).reduce((m,[f,C])=>(m[f]={id:f,...C},m),{})}));r.value=_,_.length&&(i.value=0)},J=e=>{typeof e=="string"?o.value=e.split(",").map(t=>parseInt(t,10)):Array.isArray(e)&&(o.value=e.map(t=>parseInt(t,10))),setTimeout(()=>{v.setSettings("variant_ids",o.value)},100)},le=(e=[])=>{let a={active_view:"publish",per_page:10,page:1,filter_type:"advanced",sort_by:"ID",with:["detail.variants.media","categories","variants.media"],advanced_filters:JSON.stringify([[{source:["variations","variation_items"],filter_type:"relation",operator:"contains",value:e,column:"id",relation:"variants"}]])};ae.get("products",a).then(l=>{M.value=ge.get(l,"products.data",[]),Q(e,M.value)}).catch(l=>{console.log(l)}).finally(()=>{})},se=e=>{d.value.active_variant=e,setTimeout(()=>{v.setSettings("active_variant",e)},100)},re=()=>{d.value.active_tab!==""&&(i.value=d.value.active_tab),d.value.variations&&(o.value=d.value.variations),d.value.active_variant&&(A.value=d.value.active_variant),d.value.editor_active_tab&&(T.value=d.value.editor_active_tab),ce()},ce=()=>{setTimeout(()=>{if(o.value.length!==""){let e=[];typeof o.value=="string"?e=o.value.split(",").map(t=>parseInt(t,10)):Array.isArray(o.value)&&(e=o.value.map(t=>parseInt(t,10))),le(e)}},100)},ue=e=>{i.value=e,setTimeout(()=>{v.setSettings("active_tab",i.value)},100)},de=e=>{setTimeout(()=>{v.setSettings("editor_active_tab",e)},100)};return ve(()=>{v=he()}),pe(()=>{d.value=JSON.parse(w.settings),re()}),(e,t)=>{var f,C,q,z;const a=x("el-tab-pane"),l=x("el-tabs"),_=x("el-button"),V=x("el-option"),m=x("el-select");return u(),p(I,null,[S(l,{modelValue:T.value,"onUpdate:modelValue":t[0]||(t[0]=n=>T.value=n),class:"demo-tabs",onTabChange:de},{default:P(()=>[S(a,{label:b(g)("Editor"),name:"editor"},null,8,["label"]),S(a,{label:b(g)("Preview"),name:"preview"},null,8,["label"])]),_:1},8,["modelValue"]),T.value==="preview"?(u(),p("div",Se,[S(be,{block:"fluent-cart/product-pricing-table",attributes:d.value},null,8,["attributes"])])):(u(),p("div",ke,[s("div",we,[S(fe,{isMultiple:!0,selectedIds:o.value,onOnVariationSelectionUpdated:Q},null,8,["selectedIds"])]),s("div",Ae,[r.value.length>0&&Object.keys(((f=r.value[i.value])==null?void 0:f.content)||{}).length>0?(u(),p("div",je,[r.value.length>1?(u(),p("div",Ee,[(u(!0),p(I,null,B(r.value,(n,c)=>(u(),R(_,{key:c,class:$({"is-primary":i.value==c," components-button":!0}),onClick:j=>ue(c)},{default:P(()=>[te(k(n.title),1)]),_:2},1032,["class","onClick"]))),128))])):ee("",!0),s("div",Oe,[r.value[i.value]?(u(),p("div",xe,[s("div",De,[s("div",Te,[s("label",null,k(b(g)("Recommended variant")),1),(u(),R(m,{key:((C=r.value[i.value])==null?void 0:C.title)||"",modelValue:A.value[((q=r.value[i.value])==null?void 0:q.title)||""],"onUpdate:modelValue":t[1]||(t[1]=n=>{var c;return A.value[((c=r.value[i.value])==null?void 0:c.title)||""]=n}),onChange:t[2]||(t[2]=n=>{var c;A.value={...A.value,[((c=r.value[i.value])==null?void 0:c.title)||""]:n},se(A.value)})},{default:P(()=>{var n;return[(u(!0),p(I,null,B(Object.keys(((n=r.value[i.value])==null?void 0:n.content)||{}),c=>{var j,O;return u(),R(V,{key:c,value:c,label:((O=(j=r.value[i.value])==null?void 0:j.content[c])==null?void 0:O.variation_title)||c},null,8,["value","label"])}),128))]}),_:1},8,["modelValue"]))])]),s("div",Ie,[(u(!0),p(I,null,B(Object.keys(((z=r.value[i.value])==null?void 0:z.content)||{}),n=>{var c,j,O,G,L,W,X,Y,Z;return u(),p("div",{key:`variations-${(j=(c=r.value[i.value])==null?void 0:c.content[n])==null?void 0:j.id}`,class:"fc-selected-product"},[s("div",{class:$(["fc-selected-product-toggle",{"is-expanded":E.value[n]}]),onClick:N=>ne(n)},[s("div",Fe,[S(Ve,{class:"w-3 h-3"})])],10,Ne),s("div",Pe,[s("div",{class:"product-title",title:(G=(O=r.value[i.value])==null?void 0:O.content[n])==null?void 0:G.variation_title},k((W=(L=r.value[i.value])==null?void 0:L.content[n])==null?void 0:W.variation_title),9,Be),s("div",Re,"#"+k(n),1),s("div",{class:$(["product-textarea",{"is-expanded":E.value[n]}])},[s("div",$e,[s("textarea",{placeholder:b(g)("Variants features..."),value:((Z=(Y=(X=r.value[i.value])==null?void 0:X.content[n])==null?void 0:Y.other_info)==null?void 0:Z.description)||"",onBlur:N=>{var K;const F=(K=r.value[i.value])==null?void 0:K.content[n];F&&(F.other_info.description=N.target.value.replace(/\r?\n/g,`
`),oe(n,F))}},null,40,Ue),s("div",Me,[s("strong",null,k(b(g)("Hint: ")),1),te(" "+k(b(g)("Use Enter to add line breaks for a list format")),1)])])],2)]),s("div",{class:"product-delete-icon",onClick:N=>ie(n),title:b(g)("Delete"),style:{cursor:"pointer"}},[S(Ce,{class:"w-4 h-4"})],8,Qe)])}),128))])])):ee("",!0)])])):(u(),p("div",He,[s("div",null,k(b(g)("Find products to make a pricing table")),1)]))])]))],64)}}},qe=y=>{const v=y.dataset.settings,w=_e(Je,{settings:v});me(w),w.mixin({methods:{$t:g}}).mount(y)};jQuery(document).ready(function(){elementor.hooks.addAction("panel/open_editor/widget/fluent_cart_pricing_table",function(y,v,w){v.get("settings")})});jQuery(window).on("elementor/frontend/init",function(){elementorFrontend.hooks.addAction("frontend/element_ready/fluent_cart_pricing_table.default",function(y){const v=jQuery(y[0]).find("[data-fluent-cart-pricing-table-app]")[0];qe(v)})});
